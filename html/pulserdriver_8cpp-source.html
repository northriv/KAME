<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=euc-jp">
<title>KAME2: modules/nmr/core/pulserdriver.cpp ソースファイル</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- 作成： Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>メインページ</span></a></li>
    <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
    <li><a href="classes.html"><span>クラス</span></a></li>
    <li id="current"><a href="files.html"><span>ファイル</span></a></li>
    <li><a href="dirs.html"><span>ディレクトリ</span></a></li>
    <li><a href="pages.html"><span>関連ページ</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_c17a6312adb6ef1af4037d741e35ac41.html">modules</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a39626054ece7eaf0438159c3390d9e6.html">nmr</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_d5faa35cb1b6dc9b8e3c130a89652ec6.html">core</a></div>
<h1>pulserdriver.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">                Copyright (C) 2002-2007 Kentaro Kitagawa</span>
<a name="l00003"></a>00003 <span class="comment">                                   kitag@issp.u-tokyo.ac.jp</span>
<a name="l00004"></a>00004 <span class="comment">                </span>
<a name="l00005"></a>00005 <span class="comment">                This program is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment">                modify it under the terms of the GNU Library General Public</span>
<a name="l00007"></a>00007 <span class="comment">                License as published by the Free Software Foundation; either</span>
<a name="l00008"></a>00008 <span class="comment">                version 2 of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">                </span>
<a name="l00010"></a>00010 <span class="comment">                You should have received a copy of the GNU Library General </span>
<a name="l00011"></a>00011 <span class="comment">                Public License and a list of authors along with this program; </span>
<a name="l00012"></a>00012 <span class="comment">                see the files COPYING and AUTHORS.</span>
<a name="l00013"></a>00013 <span class="comment">***************************************************************************/</span>
<a name="l00014"></a>00014 <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "pulserdriver.h"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "forms/pulserdriverform.h"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "forms/pulserdrivermoreform.h"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "pulserdriverconnector.h"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "interface.h"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "analyzer.h"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "xnodeconnector.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;knuminput.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;qpushbutton.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;qcheckbox.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;qstatusbar.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;kapplication.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;kiconloader.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;klocale.h&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;gsl/gsl_sf.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#define bessel_i0 gsl_sf_bessel_I0</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#define PULSE_FUNC_RECT "Rect. BW=0.89/T"</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_HANNING "Hanning BW=1.44/T"</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_HAMMING "Hamming BW=1.30/T"</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_FLATTOP "Flat-Top BW=3.2/T"</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_FLATTOP_LONG "Flat-Top BW=5.3/T"</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_FLATTOP_LONG_LONG "Flat-Top BW=6.8/T"</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_BLACKMAN "Blackman BW=1.7/T"</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_BLACKMAN_HARRIS "Blackman-Harris BW=1.9/T"</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_KAISER_1 "Kaiser(3) BW=1.6/T"</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_KAISER_2 "Kaiser(7.2) BW=2.6/T"</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_KAISER_3 "Kaiser(15) BW=3.8/T"</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define PULSE_FUNC_HALF_SIN "Half-sin BW=1.2/T"</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#define NUM_PHASE_CYCLE_1 "1"</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#define NUM_PHASE_CYCLE_2 "2"</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#define NUM_PHASE_CYCLE_4 "4"</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#define NUM_PHASE_CYCLE_8 "8"</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#define NUM_PHASE_CYCLE_16 "16"</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a>00052 <span class="preprocessor">#define COMB_MODE_OFF "Comb Off"</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#define COMB_MODE_ON "Comb On"</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#define COMB_MODE_P1_ALT "P1 ALT"</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#define COMB_MODE_COMB_ALT "Comb ALT"</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 <span class="preprocessor">#define RT_MODE_FIXREP "Fix Rep. Time"</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#define RT_MODE_FIXREST "Fix Rest Time"</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <a class="code" href="class_x_pulser.html#b87c1a6b0a1f1da26ef7f798ff695ba3">XPulser::tpulsefunc</a>
<a name="l00061"></a><a class="code" href="class_x_pulser.html#a3c22667ea5c05c45e43b1a76c4ed056">00061</a> <a class="code" href="class_x_pulser.html#a3c22667ea5c05c45e43b1a76c4ed056">XPulser::pulseFunc</a>(<span class="keyword">const</span> std::string &amp;str)<span class="keyword"> const </span>{
<a name="l00062"></a>00062         <span class="keywordflow">if</span>(str == PULSE_FUNC_HANNING) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#709306b977de5317ed30061482f6241e">FFT::windowFuncHanning</a>;
<a name="l00063"></a>00063         <span class="keywordflow">if</span>(str == PULSE_FUNC_HAMMING) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#43e2fb4a6e22f751b4e49df777b6b760">FFT::windowFuncHamming</a>;
<a name="l00064"></a>00064         <span class="keywordflow">if</span>(str == PULSE_FUNC_BLACKMAN) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#fb4e4948e23a7e64f09856ec52aafdc8">FFT::windowFuncBlackman</a>;
<a name="l00065"></a>00065         <span class="keywordflow">if</span>(str == PULSE_FUNC_BLACKMAN_HARRIS) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#e93c2361380aed126c92ee355c977413">FFT::windowFuncBlackmanHarris</a>;
<a name="l00066"></a>00066         <span class="keywordflow">if</span>(str == PULSE_FUNC_KAISER_1) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#29f8d8b288aa5a0dfb39c4671f6fa9fa">FFT::windowFuncKaiser1</a>;
<a name="l00067"></a>00067         <span class="keywordflow">if</span>(str == PULSE_FUNC_KAISER_2) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#6fb74d7bb151d18a38def0aa2ca556e1">FFT::windowFuncKaiser2</a>;
<a name="l00068"></a>00068         <span class="keywordflow">if</span>(str == PULSE_FUNC_KAISER_3) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#7cdab02653fc56c7d60d752ba8cf036d">FFT::windowFuncKaiser3</a>;
<a name="l00069"></a>00069         <span class="keywordflow">if</span>(str == PULSE_FUNC_FLATTOP) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#d694f6e056fdfeb5a15e7fe0490a00f0">FFT::windowFuncFlatTop</a>;
<a name="l00070"></a>00070         <span class="keywordflow">if</span>(str == PULSE_FUNC_FLATTOP_LONG) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#584567505771133c7c3b00f9afc0a27e">FFT::windowFuncFlatTopLong</a>;
<a name="l00071"></a>00071         <span class="keywordflow">if</span>(str == PULSE_FUNC_FLATTOP_LONG_LONG) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#d49435c0e62d37f72a71bece887418a9">FFT::windowFuncFlatTopLongLong</a>;
<a name="l00072"></a>00072     <span class="keywordflow">if</span>(str == PULSE_FUNC_HALF_SIN) <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#1f7a39f0764c11d8d1276a91a3192ca5">FFT::windowFuncHalfSin</a>;
<a name="l00073"></a>00073         <span class="keywordflow">return</span> &amp;<a class="code" href="class_f_f_t.html#c2f2a73910073d2f7e059cf10bd10d52">FFT::windowFuncRect</a>;
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="class_x_pulser.html#819af443e9c3e8b3533e4ff18b8dd857">00076</a> <a class="code" href="class_x_pulser.html#819af443e9c3e8b3533e4ff18b8dd857">XPulser::XPulser</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">bool</span> runtime, 
<a name="l00077"></a>00077                                  <span class="keyword">const</span> shared_ptr&lt;XScalarEntryList&gt; &amp;scalarentries,
<a name="l00078"></a>00078                                  <span class="keyword">const</span> shared_ptr&lt;XInterfaceList&gt; &amp;interfaces,
<a name="l00079"></a>00079                                  <span class="keyword">const</span> shared_ptr&lt;XThermometerList&gt; &amp;thermometers,
<a name="l00080"></a>00080                                  <span class="keyword">const</span> shared_ptr&lt;XDriverList&gt; &amp;drivers) :
<a name="l00081"></a>00081     <a class="code" href="class_x_primary_driver.html">XPrimaryDriver</a>(name, runtime, scalarentries, interfaces, thermometers, drivers),
<a name="l00082"></a>00082     m_output(create&lt;<a class="code" href="class_x_value_node.html">XBoolNode</a>&gt;(<span class="stringliteral">"Output"</span>, true)),
<a name="l00083"></a>00083     m_combMode(create&lt;<a class="code" href="class_x_combo_node.html">XComboNode</a>&gt;(<span class="stringliteral">"CombMode"</span>, false, true)),
<a name="l00084"></a>00084     m_rtMode(create&lt;<a class="code" href="class_x_combo_node.html">XComboNode</a>&gt;(<span class="stringliteral">"RTMode"</span>, false, true)),
<a name="l00085"></a>00085     m_rt(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"RT"</span>, false, <span class="stringliteral">"%.7g"</span>)),
<a name="l00086"></a>00086     m_tau(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"Tau"</span>, false, <span class="stringliteral">"%.7g"</span>)),
<a name="l00087"></a>00087     m_combPW(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"CombPW"</span>, false)),
<a name="l00088"></a>00088     m_pw1(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"PW1"</span>, false)),
<a name="l00089"></a>00089     m_pw2(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"PW2"</span>, false)),
<a name="l00090"></a>00090     m_combNum(create&lt;<a class="code" href="class_x_value_node.html">XUIntNode</a>&gt;(<span class="stringliteral">"CombNum"</span>, false)),
<a name="l00091"></a>00091     m_combPT(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"CombPT"</span>, false)),
<a name="l00092"></a>00092     m_combP1(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"CombP1"</span>, false, <span class="stringliteral">"%.7g"</span>)),
<a name="l00093"></a>00093     m_combP1Alt(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"CombP1Alt"</span>, false, <span class="stringliteral">"%.7g"</span>)),
<a name="l00094"></a>00094     m_aswSetup(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"ASWSetup"</span>, false)),
<a name="l00095"></a>00095     m_aswHold(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"ASWHold"</span>, false)),
<a name="l00096"></a>00096     m_altSep(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"ALTSep"</span>, false)),
<a name="l00097"></a>00097     m_g2Setup(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"Gate2Setup"</span>, false)),
<a name="l00098"></a>00098     m_echoNum(create&lt;<a class="code" href="class_x_value_node.html">XUIntNode</a>&gt;(<span class="stringliteral">"EchoNum"</span>, false)),
<a name="l00099"></a>00099     m_combOffRes(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"CombOffRes"</span>, false)),
<a name="l00100"></a>00100     m_drivenEquilibrium(create&lt;<a class="code" href="class_x_value_node.html">XBoolNode</a>&gt;(<span class="stringliteral">"DrivenEquilibrium"</span>, false)),
<a name="l00101"></a>00101     m_numPhaseCycle(create&lt;<a class="code" href="class_x_combo_node.html">XComboNode</a>&gt;(<span class="stringliteral">"NumPhaseCycle"</span>, false, true)),
<a name="l00102"></a>00102     m_p1Func(create&lt;<a class="code" href="class_x_combo_node.html">XComboNode</a>&gt;(<span class="stringliteral">"P1Func"</span>, false, true)),
<a name="l00103"></a>00103     m_p2Func(create&lt;<a class="code" href="class_x_combo_node.html">XComboNode</a>&gt;(<span class="stringliteral">"P2Func"</span>, false, true)),
<a name="l00104"></a>00104     m_combFunc(create&lt;<a class="code" href="class_x_combo_node.html">XComboNode</a>&gt;(<span class="stringliteral">"CombFunc"</span>, false, true)),
<a name="l00105"></a>00105     m_p1Level(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"P1Level"</span>, false)),
<a name="l00106"></a>00106     m_p2Level(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"P2Level"</span>, false)),
<a name="l00107"></a>00107     m_combLevel(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"CombLevel"</span>, false)),
<a name="l00108"></a>00108     m_masterLevel(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"MasterLevel"</span>, false)),
<a name="l00109"></a>00109     m_qamOffset1(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QAMOffset1"</span>, false)),
<a name="l00110"></a>00110     m_qamOffset2(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QAMOffset2"</span>, false)),
<a name="l00111"></a>00111     m_qamLevel1(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QAMLevel1"</span>, false)),
<a name="l00112"></a>00112     m_qamLevel2(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QAMLevel2"</span>, false)),
<a name="l00113"></a>00113     m_qamDelay1(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QAMDelay1"</span>, false)),
<a name="l00114"></a>00114     m_qamDelay2(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QAMDelay2"</span>, false)),
<a name="l00115"></a>00115     m_difFreq(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"DIFFreq"</span>, false)),
<a name="l00116"></a>00116     m_induceEmission(create&lt;<a class="code" href="class_x_value_node.html">XBoolNode</a>&gt;(<span class="stringliteral">"InduceEmission"</span>, false)),
<a name="l00117"></a>00117     m_induceEmissionPhase(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"InduceEmissionPhase"</span>, false)),
<a name="l00118"></a>00118     m_qswDelay(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QSWDelay"</span>, false)),
<a name="l00119"></a>00119     m_qswWidth(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QSWWidth"</span>, false)),
<a name="l00120"></a>00120     m_qswSoftSWOff(create&lt;<a class="code" href="class_x_double_node.html">XDoubleNode</a>&gt;(<span class="stringliteral">"QSWSoftSWOff"</span>, false)),
<a name="l00121"></a>00121     m_invertPhase(create&lt;<a class="code" href="class_x_value_node.html">XBoolNode</a>&gt;(<span class="stringliteral">"InvertPhase"</span>, false)),
<a name="l00122"></a>00122     m_conserveStEPhase(create&lt;<a class="code" href="class_x_value_node.html">XBoolNode</a>&gt;(<span class="stringliteral">"ConserveStEPhase"</span>, false)),
<a name="l00123"></a>00123     m_qswPiPulseOnly(create&lt;<a class="code" href="class_x_value_node.html">XBoolNode</a>&gt;(<span class="stringliteral">"QSWPiPulseOnly"</span>, false)),
<a name="l00124"></a>00124     m_moreConfigShow(create&lt;<a class="code" href="class_x_node.html">XNode</a>&gt;(<span class="stringliteral">"MoreConfigShow"</span>, true)),
<a name="l00125"></a>00125     m_form(new FrmPulser(g_pFrmMain)),
<a name="l00126"></a>00126     m_formMore(new FrmPulserMore(g_pFrmMain))
<a name="l00127"></a>00127 {
<a name="l00128"></a>00128         {
<a name="l00129"></a>00129                 QComboBox*<span class="keyword">const</span> combo[] = {
<a name="l00130"></a>00130                         <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel0, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel1, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel2, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel3,
<a name="l00131"></a>00131                         <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel4, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel5, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel6, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel7, 
<a name="l00132"></a>00132                         <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel8, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel9, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel10, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel11, 
<a name="l00133"></a>00133                         <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel12, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel13, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel14, <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;m_cmbPortSel15
<a name="l00134"></a>00134                 };
<a name="l00135"></a>00135                 <span class="keyword">const</span> <span class="keywordtype">char</span> *desc[] = {
<a name="l00136"></a>00136                         <span class="stringliteral">"Gate"</span>, <span class="stringliteral">"PreGate"</span>, <span class="stringliteral">"Gate3"</span>, <span class="stringliteral">"Trig1"</span>, <span class="stringliteral">"Trig2"</span>, <span class="stringliteral">"ASW"</span>,
<a name="l00137"></a>00137                         <span class="stringliteral">"QSW"</span>, <span class="stringliteral">"Pulse1"</span>, <span class="stringliteral">"Pulse2"</span>, <span class="stringliteral">"Comb"</span>, <span class="stringliteral">"CombFM"</span>,
<a name="l00138"></a>00138                         <span class="stringliteral">"QPSK-A"</span>, <span class="stringliteral">"QPSK-B"</span>, <span class="stringliteral">"QPSK-NonInv"</span>, <span class="stringliteral">"QPSK-Inv"</span>,
<a name="l00139"></a>00139                         <span class="stringliteral">"QPSK-PS-Gate"</span>, 0L
<a name="l00140"></a>00140                 };
<a name="l00141"></a>00141                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; NUM_DO_PORTS; i++) {
<a name="l00142"></a>00142                         <a class="code" href="class_x_pulser.html#5dcca525ffcb4c228238c6394ce718b9">m_portSel</a>[i] = create&lt;XComboNode&gt;(formatString(<span class="stringliteral">"PortSel%u"</span>, i).c_str(), <span class="keyword">false</span>);
<a name="l00143"></a>00143                         <a class="code" href="class_x_pulser.html#4ff4478149418ace440bcb713a6936fb">m_conPortSel</a>[i] = xqcon_create&lt;XQComboBoxConnector&gt;(<a class="code" href="class_x_pulser.html#5dcca525ffcb4c228238c6394ce718b9">m_portSel</a>[i], combo[i]);
<a name="l00144"></a>00144                         <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keywordtype">char</span> **p = &amp;desc[0]; *p; p++)
<a name="l00145"></a>00145                                 m_portSel[i]-&gt;add(*p);
<a name="l00146"></a>00146 <span class="comment">//                      m_portSel[i]-&gt;setUIEnabled(false);</span>
<a name="l00147"></a>00147                 }
<a name="l00148"></a>00148                 <a class="code" href="class_x_pulser.html#da5f4424954fd54ef511d5bc3b2bcf05">portSel</a>(0)-&gt;value(PORTSEL_GATE);
<a name="l00149"></a>00149                 <a class="code" href="class_x_pulser.html#da5f4424954fd54ef511d5bc3b2bcf05">portSel</a>(1)-&gt;value(PORTSEL_PREGATE);
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151         
<a name="l00152"></a>00152     m_form-&gt;m_btnMoreConfig-&gt;setIconSet(
<a name="l00153"></a>00153                 KApplication::kApplication()-&gt;iconLoader()-&gt;loadIconSet(<span class="stringliteral">"configure"</span>, 
<a name="l00154"></a>00154                                                                                                                                 KIcon::Toolbar, KIcon::SizeSmall, <span class="keyword">true</span> ) );     
<a name="l00155"></a>00155     
<a name="l00156"></a>00156         rtime()-&gt;value(100.0);
<a name="l00157"></a>00157         tau()-&gt;value(100.0);
<a name="l00158"></a>00158         combPW()-&gt;value(5.0);
<a name="l00159"></a>00159         pw1()-&gt;value(5.0);
<a name="l00160"></a>00160         pw2()-&gt;value(10.0);
<a name="l00161"></a>00161         combNum()-&gt;value(1);
<a name="l00162"></a>00162         combPT()-&gt;value(20.0);
<a name="l00163"></a>00163         combP1()-&gt;value(0.2);
<a name="l00164"></a>00164         combP1Alt()-&gt;value(50.0);
<a name="l00165"></a>00165         aswSetup()-&gt;value(0.02);
<a name="l00166"></a>00166         aswHold()-&gt;value(0.23);
<a name="l00167"></a>00167         altSep()-&gt;value(0.25);
<a name="l00168"></a>00168         g2Setup()-&gt;value(5.0);
<a name="l00169"></a>00169         echoNum()-&gt;value(1);
<a name="l00170"></a>00170         combOffRes()-&gt;value(0.0);
<a name="l00171"></a>00171         drivenEquilibrium()-&gt;value(<span class="keyword">false</span>);
<a name="l00172"></a>00172         numPhaseCycle()-&gt;add(NUM_PHASE_CYCLE_1);
<a name="l00173"></a>00173         numPhaseCycle()-&gt;add(NUM_PHASE_CYCLE_2);
<a name="l00174"></a>00174         numPhaseCycle()-&gt;add(NUM_PHASE_CYCLE_4);
<a name="l00175"></a>00175         numPhaseCycle()-&gt;add(NUM_PHASE_CYCLE_8);
<a name="l00176"></a>00176         numPhaseCycle()-&gt;add(NUM_PHASE_CYCLE_16);
<a name="l00177"></a>00177         numPhaseCycle()-&gt;value(NUM_PHASE_CYCLE_16);
<a name="l00178"></a>00178         p1Level()-&gt;value(-5.0);
<a name="l00179"></a>00179         p2Level()-&gt;value(-0.5);
<a name="l00180"></a>00180         combLevel()-&gt;value(-5.0);
<a name="l00181"></a>00181         masterLevel()-&gt;value(-10.0);
<a name="l00182"></a>00182         qamLevel1()-&gt;value(1.0);
<a name="l00183"></a>00183         qamLevel2()-&gt;value(1.0);
<a name="l00184"></a>00184         qswDelay()-&gt;value(5.0);
<a name="l00185"></a>00185         qswWidth()-&gt;value(10.0);
<a name="l00186"></a>00186         qswSoftSWOff()-&gt;value(1.0);
<a name="l00187"></a>00187  
<a name="l00188"></a>00188         combMode()-&gt;add(COMB_MODE_OFF);
<a name="l00189"></a>00189         combMode()-&gt;add(COMB_MODE_ON);
<a name="l00190"></a>00190         combMode()-&gt;add(COMB_MODE_P1_ALT);
<a name="l00191"></a>00191         combMode()-&gt;add(COMB_MODE_COMB_ALT);
<a name="l00192"></a>00192         combMode()-&gt;value(N_COMB_MODE_OFF);
<a name="l00193"></a>00193         rtMode()-&gt;add(RT_MODE_FIXREP);
<a name="l00194"></a>00194         rtMode()-&gt;add(RT_MODE_FIXREST);
<a name="l00195"></a>00195         rtMode()-&gt;value(1);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         p1Func()-&gt;add(PULSE_FUNC_RECT);
<a name="l00198"></a>00198         p1Func()-&gt;add(PULSE_FUNC_HANNING);
<a name="l00199"></a>00199         p1Func()-&gt;add(PULSE_FUNC_HAMMING);
<a name="l00200"></a>00200         p1Func()-&gt;add(PULSE_FUNC_BLACKMAN);
<a name="l00201"></a>00201         p1Func()-&gt;add(PULSE_FUNC_BLACKMAN_HARRIS);
<a name="l00202"></a>00202         p1Func()-&gt;add(PULSE_FUNC_FLATTOP);
<a name="l00203"></a>00203         p1Func()-&gt;add(PULSE_FUNC_FLATTOP_LONG);
<a name="l00204"></a>00204         p1Func()-&gt;add(PULSE_FUNC_FLATTOP_LONG_LONG);
<a name="l00205"></a>00205         p1Func()-&gt;add(PULSE_FUNC_KAISER_1);
<a name="l00206"></a>00206         p1Func()-&gt;add(PULSE_FUNC_KAISER_2);
<a name="l00207"></a>00207         p1Func()-&gt;add(PULSE_FUNC_KAISER_3);
<a name="l00208"></a>00208         p1Func()-&gt;add(PULSE_FUNC_HALF_SIN);
<a name="l00209"></a>00209     p2Func()-&gt;add(PULSE_FUNC_RECT);
<a name="l00210"></a>00210     p2Func()-&gt;add(PULSE_FUNC_HANNING);
<a name="l00211"></a>00211     p2Func()-&gt;add(PULSE_FUNC_HAMMING);
<a name="l00212"></a>00212     p2Func()-&gt;add(PULSE_FUNC_BLACKMAN);
<a name="l00213"></a>00213     p2Func()-&gt;add(PULSE_FUNC_BLACKMAN_HARRIS);
<a name="l00214"></a>00214     p2Func()-&gt;add(PULSE_FUNC_FLATTOP);
<a name="l00215"></a>00215     p2Func()-&gt;add(PULSE_FUNC_FLATTOP_LONG);
<a name="l00216"></a>00216     p2Func()-&gt;add(PULSE_FUNC_FLATTOP_LONG_LONG);
<a name="l00217"></a>00217     p2Func()-&gt;add(PULSE_FUNC_KAISER_1);
<a name="l00218"></a>00218     p2Func()-&gt;add(PULSE_FUNC_KAISER_2);
<a name="l00219"></a>00219     p2Func()-&gt;add(PULSE_FUNC_KAISER_3);
<a name="l00220"></a>00220     p2Func()-&gt;add(PULSE_FUNC_HALF_SIN);
<a name="l00221"></a>00221         combFunc()-&gt;add(PULSE_FUNC_RECT);
<a name="l00222"></a>00222         combFunc()-&gt;add(PULSE_FUNC_HANNING);
<a name="l00223"></a>00223         combFunc()-&gt;add(PULSE_FUNC_HAMMING);
<a name="l00224"></a>00224         combFunc()-&gt;add(PULSE_FUNC_BLACKMAN);
<a name="l00225"></a>00225         combFunc()-&gt;add(PULSE_FUNC_BLACKMAN_HARRIS);
<a name="l00226"></a>00226         combFunc()-&gt;add(PULSE_FUNC_FLATTOP);
<a name="l00227"></a>00227         combFunc()-&gt;add(PULSE_FUNC_FLATTOP_LONG);
<a name="l00228"></a>00228         combFunc()-&gt;add(PULSE_FUNC_FLATTOP_LONG_LONG);
<a name="l00229"></a>00229         combFunc()-&gt;add(PULSE_FUNC_KAISER_1);
<a name="l00230"></a>00230         combFunc()-&gt;add(PULSE_FUNC_KAISER_2);
<a name="l00231"></a>00231         combFunc()-&gt;add(PULSE_FUNC_KAISER_3);
<a name="l00232"></a>00232         combFunc()-&gt;add(PULSE_FUNC_HALF_SIN);
<a name="l00233"></a>00233     
<a name="l00234"></a>00234         p1Func()-&gt;value(PULSE_FUNC_KAISER_2);
<a name="l00235"></a>00235         p2Func()-&gt;value(PULSE_FUNC_KAISER_2);
<a name="l00236"></a>00236         combFunc()-&gt;value(PULSE_FUNC_FLATTOP);
<a name="l00237"></a>00237   
<a name="l00238"></a>00238         m_form-&gt;setCaption(<a class="code" href="namespace_k_a_m_e.html#2773169baae29cb1a051baaef534fb63">KAME::i18n</a>(<span class="stringliteral">"Pulser Control"</span>) + <span class="stringliteral">" - "</span> + getLabel() );
<a name="l00239"></a>00239         m_formMore-&gt;setCaption(<a class="code" href="namespace_k_a_m_e.html#2773169baae29cb1a051baaef534fb63">KAME::i18n</a>(<span class="stringliteral">"Pulser Control More Config."</span>) + <span class="stringliteral">" - "</span> + getLabel() );
<a name="l00240"></a>00240         m_form-&gt;statusBar()-&gt;hide();
<a name="l00241"></a>00241         m_formMore-&gt;statusBar()-&gt;hide();
<a name="l00242"></a>00242   
<a name="l00243"></a>00243         m_conMoreConfigShow = xqcon_create&lt;XQButtonConnector&gt;(
<a name="l00244"></a>00244         m_moreConfigShow, m_form-&gt;m_btnMoreConfig);
<a name="l00245"></a>00245         m_lsnOnMoreConfigShow = m_moreConfigShow-&gt;onTouch().connectWeak(
<a name="l00246"></a>00246                 shared_from_this(), &amp;<a class="code" href="class_x_pulser.html#47308628fe4641f230b3f29ac3639fc0">XPulser::onMoreConfigShow</a>,
<a name="l00247"></a>00247                 XListener::FLAG_MAIN_THREAD_CALL | XListener::FLAG_AVOID_DUP);
<a name="l00248"></a>00248   
<a name="l00249"></a>00249         m_conOutput = xqcon_create&lt;XQToggleButtonConnector&gt;(m_output, m_form-&gt;m_ckbOutput);
<a name="l00250"></a>00250         m_conCombMode = xqcon_create&lt;XQComboBoxConnector&gt;(m_combMode, m_form-&gt;m_cmbCombMode);
<a name="l00251"></a>00251         m_conRTMode = xqcon_create&lt;XQComboBoxConnector&gt;(m_rtMode, m_form-&gt;m_cmbRTMode);
<a name="l00252"></a>00252         m_conRT = xqcon_create&lt;XQLineEditConnector&gt;(m_rt, m_form-&gt;m_edRT);
<a name="l00253"></a>00253         m_conTau = xqcon_create&lt;XQLineEditConnector&gt;(m_tau, m_form-&gt;m_edTau);
<a name="l00254"></a>00254         m_conCombPW = xqcon_create&lt;XQLineEditConnector&gt;(m_combPW, m_form-&gt;m_edCombPW);
<a name="l00255"></a>00255         m_conPW1 = xqcon_create&lt;XQLineEditConnector&gt;(m_pw1, m_form-&gt;m_edPW1);
<a name="l00256"></a>00256         m_conPW2 = xqcon_create&lt;XQLineEditConnector&gt;(m_pw2, m_form-&gt;m_edPW2);
<a name="l00257"></a>00257         m_conCombNum = xqcon_create&lt;XQSpinBoxConnector&gt;(m_combNum, m_form-&gt;m_numCombNum);
<a name="l00258"></a>00258         m_conCombPT = xqcon_create&lt;XQLineEditConnector&gt;(m_combPT, m_form-&gt;m_edCombPT);
<a name="l00259"></a>00259         m_conCombP1 = xqcon_create&lt;XQLineEditConnector&gt;(m_combP1, m_form-&gt;m_edCombP1);
<a name="l00260"></a>00260         m_conCombP1Alt = xqcon_create&lt;XQLineEditConnector&gt;(m_combP1Alt, m_form-&gt;m_edCombP1Alt);
<a name="l00261"></a>00261         m_conASWSetup = xqcon_create&lt;XQLineEditConnector&gt;(m_aswSetup, m_formMore-&gt;m_edASWSetup);
<a name="l00262"></a>00262         m_conASWHold = xqcon_create&lt;XQLineEditConnector&gt;(m_aswHold, m_formMore-&gt;m_edASWHold);
<a name="l00263"></a>00263         m_conALTSep = xqcon_create&lt;XQLineEditConnector&gt;(m_altSep, m_formMore-&gt;m_edALTSep);
<a name="l00264"></a>00264         m_conG2Setup = xqcon_create&lt;XQLineEditConnector&gt;(m_g2Setup, m_formMore-&gt;m_edG2Setup);
<a name="l00265"></a>00265         m_conEchoNum = xqcon_create&lt;XQSpinBoxConnector&gt;(m_echoNum, m_formMore-&gt;m_numEcho);
<a name="l00266"></a>00266         m_conDrivenEquilibrium = xqcon_create&lt;XQToggleButtonConnector&gt;(m_drivenEquilibrium, m_formMore-&gt;m_ckbDrivenEquilibrium);
<a name="l00267"></a>00267         m_conNumPhaseCycle = xqcon_create&lt;XQComboBoxConnector&gt;(m_numPhaseCycle, m_formMore-&gt;m_cmbPhaseCycle);
<a name="l00268"></a>00268         m_conCombOffRes = xqcon_create&lt;XQLineEditConnector&gt;(m_combOffRes, m_form-&gt;m_edCombOffRes);
<a name="l00269"></a>00269         m_conInvertPhase = xqcon_create&lt;XQToggleButtonConnector&gt;(m_invertPhase, m_formMore-&gt;m_ckbInvertPhase);
<a name="l00270"></a>00270         m_conConserveStEPhase = xqcon_create&lt;XQToggleButtonConnector&gt;(m_conserveStEPhase, m_formMore-&gt;m_ckbStEPhase);
<a name="l00271"></a>00271         m_conP1Func = xqcon_create&lt;XQComboBoxConnector&gt;(m_p1Func, m_form-&gt;m_cmbP1Func);
<a name="l00272"></a>00272         m_conP2Func = xqcon_create&lt;XQComboBoxConnector&gt;(m_p2Func, m_form-&gt;m_cmbP2Func);
<a name="l00273"></a>00273         m_conCombFunc = xqcon_create&lt;XQComboBoxConnector&gt;(m_combFunc, m_form-&gt;m_cmbCombFunc);
<a name="l00274"></a>00274         m_form-&gt;m_dblP1Level-&gt;setRange(-20.0, 3.0, 1.0, <span class="keyword">false</span>);
<a name="l00275"></a>00275         m_conP1Level = xqcon_create&lt;XKDoubleNumInputConnector&gt;(m_p1Level, m_form-&gt;m_dblP1Level);
<a name="l00276"></a>00276         m_form-&gt;m_dblP2Level-&gt;setRange(-20.0, 3.0, 1.0, <span class="keyword">false</span>);
<a name="l00277"></a>00277         m_conP2Level = xqcon_create&lt;XKDoubleNumInputConnector&gt;(m_p2Level, m_form-&gt;m_dblP2Level);
<a name="l00278"></a>00278         m_form-&gt;m_dblCombLevel-&gt;setRange(-20.0, 3.0, 1.0, <span class="keyword">false</span>);
<a name="l00279"></a>00279         m_conCombLevel = xqcon_create&lt;XKDoubleNumInputConnector&gt;(m_combLevel, m_form-&gt;m_dblCombLevel);
<a name="l00280"></a>00280         m_form-&gt;m_dblMasterLevel-&gt;setRange(-30.0, 0.0, 1.0, <span class="keyword">true</span>);
<a name="l00281"></a>00281         m_conMasterLevel = xqcon_create&lt;XKDoubleNumInputConnector&gt;(m_masterLevel, m_form-&gt;m_dblMasterLevel);
<a name="l00282"></a>00282         m_conQAMOffset1 = xqcon_create&lt;XQLineEditConnector&gt;(m_qamOffset1, m_formMore-&gt;m_edQAMOffset1);  
<a name="l00283"></a>00283         m_conQAMOffset2 = xqcon_create&lt;XQLineEditConnector&gt;(m_qamOffset2, m_formMore-&gt;m_edQAMOffset2);
<a name="l00284"></a>00284         m_conQAMLevel1 = xqcon_create&lt;XQLineEditConnector&gt;(m_qamLevel1, m_formMore-&gt;m_edQAMLevel1);  
<a name="l00285"></a>00285         m_conQAMLevel2 = xqcon_create&lt;XQLineEditConnector&gt;(m_qamLevel2, m_formMore-&gt;m_edQAMLevel2);
<a name="l00286"></a>00286         m_conQAMDelay1 = xqcon_create&lt;XQLineEditConnector&gt;(m_qamDelay1, m_formMore-&gt;m_edQAMDelay1);  
<a name="l00287"></a>00287         m_conQAMDelay2 = xqcon_create&lt;XQLineEditConnector&gt;(m_qamDelay2, m_formMore-&gt;m_edQAMDelay2);
<a name="l00288"></a>00288         m_conDIFFreq = xqcon_create&lt;XQLineEditConnector&gt;(m_difFreq, m_formMore-&gt;m_edDIFFreq);  
<a name="l00289"></a>00289         m_conInduceEmission = xqcon_create&lt;XQToggleButtonConnector&gt;(m_induceEmission, m_formMore-&gt;m_ckbInduceEmission);
<a name="l00290"></a>00290         m_conInduceEmissionPhase = xqcon_create&lt;XKDoubleNumInputConnector&gt;(m_induceEmissionPhase, m_formMore-&gt;m_numInduceEmissionPhase);
<a name="l00291"></a>00291         m_conQSWDelay = xqcon_create&lt;XQLineEditConnector&gt;(m_qswDelay, m_formMore-&gt;m_edQSWDelay);  
<a name="l00292"></a>00292         m_conQSWWidth = xqcon_create&lt;XQLineEditConnector&gt;(m_qswWidth, m_formMore-&gt;m_edQSWWidth);  
<a name="l00293"></a>00293         m_conQSWSoftSWOff = xqcon_create&lt;XQLineEditConnector&gt;(m_qswSoftSWOff, m_formMore-&gt;m_edQSWSoftSWOff);  
<a name="l00294"></a>00294         m_conQSWPiPulseOnly = xqcon_create&lt;XQToggleButtonConnector&gt;(m_qswPiPulseOnly, m_formMore-&gt;m_ckbQSWPiPulseOnly);  
<a name="l00295"></a>00295  
<a name="l00296"></a>00296         output()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00297"></a>00297         combMode()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00298"></a>00298         rtMode()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00299"></a>00299         rtime()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00300"></a>00300         tau()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00301"></a>00301         combPW()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00302"></a>00302         pw1()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00303"></a>00303         pw2()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00304"></a>00304         combNum()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00305"></a>00305         combPT()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00306"></a>00306         combP1()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00307"></a>00307         combP1Alt()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00308"></a>00308         aswSetup()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00309"></a>00309         aswHold()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00310"></a>00310         altSep()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00311"></a>00311         g2Setup()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00312"></a>00312         echoNum()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00313"></a>00313         drivenEquilibrium()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00314"></a>00314         numPhaseCycle()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00315"></a>00315         combOffRes()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00316"></a>00316         p1Func()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00317"></a>00317         p2Func()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00318"></a>00318         combFunc()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00319"></a>00319         p1Level()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00320"></a>00320         p2Level()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00321"></a>00321         combLevel()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00322"></a>00322         masterLevel()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00323"></a>00323         qamOffset1()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00324"></a>00324         qamOffset2()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00325"></a>00325         qamLevel1()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00326"></a>00326         qamLevel2()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00327"></a>00327         qamDelay1()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00328"></a>00328         qamDelay2()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00329"></a>00329         difFreq()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00330"></a>00330         induceEmission()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00331"></a>00331         induceEmissionPhase()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00332"></a>00332         qswDelay()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00333"></a>00333         qswWidth()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00334"></a>00334         qswSoftSWOff()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00335"></a>00335         qswPiPulseOnly()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00336"></a>00336         invertPhase()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00337"></a>00337         conserveStEPhase()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00338"></a>00338   
<a name="l00339"></a>00339         m_conPulserDriver = xqcon_create&lt;XQPulserDriverConnector&gt;(
<a name="l00340"></a>00340         dynamic_pointer_cast&lt;XPulser&gt;(shared_from_this()), m_form-&gt;m_tblPulse, m_form-&gt;m_graph);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="keywordtype">void</span>
<a name="l00344"></a><a class="code" href="class_x_pulser.html#7702a2bdfc28be73ce07d50477fa4530">00344</a> <a class="code" href="class_x_pulser.html#7702a2bdfc28be73ce07d50477fa4530">XPulser::showForms</a>() {
<a name="l00346"></a>00346     <a class="code" href="class_x_pulser.html#baa09fb4f34a776789411e85b3de27d3">m_form</a>-&gt;show();
<a name="l00347"></a>00347     <a class="code" href="class_x_pulser.html#baa09fb4f34a776789411e85b3de27d3">m_form</a>-&gt;raise();
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 <span class="keywordtype">void</span>
<a name="l00350"></a><a class="code" href="class_x_pulser.html#47308628fe4641f230b3f29ac3639fc0">00350</a> <a class="code" href="class_x_pulser.html#47308628fe4641f230b3f29ac3639fc0">XPulser::onMoreConfigShow</a>(<span class="keyword">const</span> shared_ptr&lt;XNode&gt; &amp;) 
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352         <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;show();
<a name="l00353"></a>00353         <a class="code" href="class_x_pulser.html#dc5c4b44b464d0949b38b7fdbcd2918d">m_formMore</a>-&gt;raise();
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <span class="keywordtype">void</span>
<a name="l00357"></a><a class="code" href="class_x_pulser.html#37f416616fd6597463d91ca3d6ef7710">00357</a> <a class="code" href="class_x_pulser.html#37f416616fd6597463d91ca3d6ef7710">XPulser::start</a>()
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359         <a class="code" href="class_x_pulser.html#7ecb8e6c23e19a846e64b94daf24bba6">output</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00360"></a>00360         <a class="code" href="class_x_pulser.html#e3adfc50a6471f9a589006d0b655d916">combMode</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00361"></a>00361         <a class="code" href="class_x_pulser.html#217bba681cbf8b302ed7e7ed9a69b5d0">rtMode</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00362"></a>00362         <a class="code" href="class_x_pulser.html#a40be34d289d1e39d690c0db7db069cc">rtime</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00363"></a>00363         <a class="code" href="class_x_pulser.html#a6f062ffe966922d8fea2ab9264b8e1c">tau</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00364"></a>00364         <a class="code" href="class_x_pulser.html#8dfd04875fd1ad4985532e9cd0c26022">combPW</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00365"></a>00365         <a class="code" href="class_x_pulser.html#a81f96b8006b7b78b513ddd1678fd9b6">pw1</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00366"></a>00366         <a class="code" href="class_x_pulser.html#0ef1c2cf73493e9f91fbc30408aea170">pw2</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00367"></a>00367         <a class="code" href="class_x_pulser.html#9b057f3a0ab711bbb1b40e8e88155d62">combNum</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00368"></a>00368         <a class="code" href="class_x_pulser.html#6dfc9c71c0dffc489eaf59892c4d228e">combPT</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00369"></a>00369         <a class="code" href="class_x_pulser.html#a14c52a1ede57762c1603d841a8efb66">combP1</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00370"></a>00370         <a class="code" href="class_x_pulser.html#83bb50884c71ab57ec1f1fb304afa8d3">combP1Alt</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00371"></a>00371         <a class="code" href="class_x_pulser.html#939e9859fa6a244076e2930764aecd88">aswSetup</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00372"></a>00372         <a class="code" href="class_x_pulser.html#5250fe217ada95071161c7012f1eea26">aswHold</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00373"></a>00373         <a class="code" href="class_x_pulser.html#9d4cbdaeb611c148f157c7c2de18a967">altSep</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00374"></a>00374         <a class="code" href="class_x_pulser.html#9718f99086c9408e2e3977fe31eb2bcd">g2Setup</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00375"></a>00375         <a class="code" href="class_x_pulser.html#8463ec3d3386ceb345171cf1d516a883">echoNum</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00376"></a>00376         <a class="code" href="class_x_pulser.html#02de09864e63ba9b002e329b02b0255c">drivenEquilibrium</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00377"></a>00377         <a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00378"></a>00378         <a class="code" href="class_x_pulser.html#44778cb0f8708d070f3b61efdf108563">combOffRes</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00379"></a>00379         <a class="code" href="class_x_pulser.html#c55af557a7fe05cc1ddb73f4f71ebe39">induceEmission</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00380"></a>00380         <a class="code" href="class_x_pulser.html#f9ff61b1afe288bf418cef15b71f9a58">induceEmissionPhase</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00381"></a>00381         <a class="code" href="class_x_pulser.html#bdc8d6c38f94b72ff470b6fec3e8d70e">qswDelay</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00382"></a>00382         <a class="code" href="class_x_pulser.html#e8a0ff961e7dc409e36401a420c15d1f">qswWidth</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00383"></a>00383         <a class="code" href="class_x_pulser.html#c89a60d72422f3137af546ed03e23564">qswSoftSWOff</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00384"></a>00384         <a class="code" href="class_x_pulser.html#1adb52faaf96d006a19cd1e869bc4226">qswPiPulseOnly</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00385"></a>00385         <a class="code" href="class_x_pulser.html#49a059c26ad9e012c975f2f17e964068">invertPhase</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00386"></a>00386         <a class="code" href="class_x_pulser.html#0f1ebc0a1102325ffd0644cbe200c687">conserveStEPhase</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00387"></a>00387         <span class="comment">//Port0 is locked.</span>
<a name="l00388"></a>00388         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; NUM_DO_PORTS; i++) {
<a name="l00389"></a>00389 <span class="comment">//      m_portSel[i]-&gt;setUIEnabled(true);</span>
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391   
<a name="l00392"></a>00392         <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#c60d17dc4ad6e70a13c201daa2dc197d">haveQAMPorts</a>()) {
<a name="l00393"></a>00393                 <a class="code" href="class_x_pulser.html#4ed5d0cacec4406f6efba277bd773e90">p1Func</a>()-&gt;<a class="code" href="class_x_node.html#88672dc755c34a4327adf096170f8290">setUIEnabled</a>(<span class="keyword">true</span>);
<a name="l00394"></a>00394                 <a class="code" href="class_x_pulser.html#be63505c5601de20bc239355126894cd">p2Func</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00395"></a>00395                 <a class="code" href="class_x_pulser.html#b9b882609d78b89aa53fe04f1d5574a9">combFunc</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00396"></a>00396                 <a class="code" href="class_x_pulser.html#9df676d6c9c2c06a9159763b623eb8dd">p1Level</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00397"></a>00397                 <a class="code" href="class_x_pulser.html#b2f98882664310fe603467bac719ce4e">p2Level</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00398"></a>00398                 <a class="code" href="class_x_pulser.html#f8a127b1e270339fbb7ae981a0e26465">combLevel</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00399"></a>00399                 <a class="code" href="class_x_pulser.html#1657f1678482e3e7ea7368a1550a8f4b">masterLevel</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00400"></a>00400                 <a class="code" href="class_x_pulser.html#ef605744a25f80c3c052c889c24d0a54">qamOffset1</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00401"></a>00401                 <a class="code" href="class_x_pulser.html#a9117e4ee8586d56a46ed7f138ac924a">qamOffset2</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00402"></a>00402                 <a class="code" href="class_x_pulser.html#cb5233619e0f16cbfb859efef43a645f">qamLevel1</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00403"></a>00403                 <a class="code" href="class_x_pulser.html#37c463677c246af6d57c0f15c41e5e64">qamLevel2</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00404"></a>00404                 <a class="code" href="class_x_pulser.html#58eff26409df38012b819dd90302cb95">qamDelay1</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00405"></a>00405                 <a class="code" href="class_x_pulser.html#c0beb6172f725e3c8b9500a6681771cb">qamDelay2</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);
<a name="l00406"></a>00406                 <a class="code" href="class_x_pulser.html#d2dee50865e4a00caf826cecad53ff28">difFreq</a>()-&gt;setUIEnabled(<span class="keyword">true</span>);  
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         m_lsnOnPulseChanged = combMode()-&gt;onValueChanged().connectWeak(
<a name="l00410"></a>00410                 shared_from_this(), &amp;<a class="code" href="class_x_pulser.html#8a9b598541d0d98a19be4a8af5df29fb">XPulser::onPulseChanged</a>);
<a name="l00411"></a>00411         rtime()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00412"></a>00412         tau()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00413"></a>00413         combPW()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00414"></a>00414         pw1()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00415"></a>00415         pw2()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00416"></a>00416         combNum()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00417"></a>00417         combPT()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00418"></a>00418         combP1()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00419"></a>00419         combP1Alt()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00420"></a>00420         aswSetup()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00421"></a>00421         aswHold()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00422"></a>00422         altSep()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00423"></a>00423         output()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00424"></a>00424         g2Setup()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00425"></a>00425         echoNum()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00426"></a>00426         drivenEquilibrium()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00427"></a>00427         numPhaseCycle()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00428"></a>00428         combOffRes()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00429"></a>00429         induceEmission()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);    
<a name="l00430"></a>00430         induceEmissionPhase()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);    
<a name="l00431"></a>00431         qswDelay()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00432"></a>00432         qswWidth()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00433"></a>00433         qswSoftSWOff()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00434"></a>00434         qswPiPulseOnly()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00435"></a>00435         invertPhase()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00436"></a>00436         conserveStEPhase()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00437"></a>00437         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; NUM_DO_PORTS; i++) {
<a name="l00438"></a>00438                 portSel(i)-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440   
<a name="l00441"></a>00441         <span class="keywordflow">if</span>(haveQAMPorts()) {
<a name="l00442"></a>00442                 p1Func()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00443"></a>00443                 p2Func()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00444"></a>00444                 combFunc()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00445"></a>00445                 p1Level()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00446"></a>00446                 p2Level()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00447"></a>00447                 combLevel()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00448"></a>00448                 masterLevel()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00449"></a>00449                 qamOffset1()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00450"></a>00450                 qamOffset2()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00451"></a>00451                 qamLevel1()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00452"></a>00452                 qamLevel2()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00453"></a>00453                 qamDelay1()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00454"></a>00454                 qamDelay2()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);
<a name="l00455"></a>00455                 difFreq()-&gt;onValueChanged().connect(m_lsnOnPulseChanged);    
<a name="l00456"></a>00456         }
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 <span class="keywordtype">void</span>
<a name="l00459"></a><a class="code" href="class_x_pulser.html#bfdf76e6b65e2abd956f503c029d3d57">00459</a> <a class="code" href="class_x_pulser.html#bfdf76e6b65e2abd956f503c029d3d57">XPulser::stop</a>()
<a name="l00460"></a>00460 {
<a name="l00461"></a>00461         <a class="code" href="class_x_pulser.html#4a9d1665a43020f6eac01d3e8abc64f4">m_lsnOnPulseChanged</a>.reset();
<a name="l00462"></a>00462   
<a name="l00463"></a>00463         <a class="code" href="class_x_pulser.html#7ecb8e6c23e19a846e64b94daf24bba6">output</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00464"></a>00464         <a class="code" href="class_x_pulser.html#e3adfc50a6471f9a589006d0b655d916">combMode</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00465"></a>00465         <a class="code" href="class_x_pulser.html#217bba681cbf8b302ed7e7ed9a69b5d0">rtMode</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00466"></a>00466         <a class="code" href="class_x_pulser.html#a40be34d289d1e39d690c0db7db069cc">rtime</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00467"></a>00467         <a class="code" href="class_x_pulser.html#a6f062ffe966922d8fea2ab9264b8e1c">tau</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00468"></a>00468         <a class="code" href="class_x_pulser.html#8dfd04875fd1ad4985532e9cd0c26022">combPW</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00469"></a>00469         <a class="code" href="class_x_pulser.html#a81f96b8006b7b78b513ddd1678fd9b6">pw1</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00470"></a>00470         <a class="code" href="class_x_pulser.html#0ef1c2cf73493e9f91fbc30408aea170">pw2</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00471"></a>00471         <a class="code" href="class_x_pulser.html#9b057f3a0ab711bbb1b40e8e88155d62">combNum</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00472"></a>00472         <a class="code" href="class_x_pulser.html#6dfc9c71c0dffc489eaf59892c4d228e">combPT</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00473"></a>00473         <a class="code" href="class_x_pulser.html#a14c52a1ede57762c1603d841a8efb66">combP1</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00474"></a>00474         <a class="code" href="class_x_pulser.html#83bb50884c71ab57ec1f1fb304afa8d3">combP1Alt</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00475"></a>00475         <a class="code" href="class_x_pulser.html#939e9859fa6a244076e2930764aecd88">aswSetup</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00476"></a>00476         <a class="code" href="class_x_pulser.html#5250fe217ada95071161c7012f1eea26">aswHold</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00477"></a>00477         <a class="code" href="class_x_pulser.html#9d4cbdaeb611c148f157c7c2de18a967">altSep</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00478"></a>00478         <a class="code" href="class_x_pulser.html#9718f99086c9408e2e3977fe31eb2bcd">g2Setup</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00479"></a>00479         <a class="code" href="class_x_pulser.html#8463ec3d3386ceb345171cf1d516a883">echoNum</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00480"></a>00480         <a class="code" href="class_x_pulser.html#02de09864e63ba9b002e329b02b0255c">drivenEquilibrium</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00481"></a>00481         <a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00482"></a>00482         <a class="code" href="class_x_pulser.html#44778cb0f8708d070f3b61efdf108563">combOffRes</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00483"></a>00483         <a class="code" href="class_x_pulser.html#4ed5d0cacec4406f6efba277bd773e90">p1Func</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00484"></a>00484         <a class="code" href="class_x_pulser.html#be63505c5601de20bc239355126894cd">p2Func</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00485"></a>00485         <a class="code" href="class_x_pulser.html#b9b882609d78b89aa53fe04f1d5574a9">combFunc</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00486"></a>00486         <a class="code" href="class_x_pulser.html#9df676d6c9c2c06a9159763b623eb8dd">p1Level</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00487"></a>00487         <a class="code" href="class_x_pulser.html#b2f98882664310fe603467bac719ce4e">p2Level</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00488"></a>00488         <a class="code" href="class_x_pulser.html#f8a127b1e270339fbb7ae981a0e26465">combLevel</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00489"></a>00489         <a class="code" href="class_x_pulser.html#1657f1678482e3e7ea7368a1550a8f4b">masterLevel</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00490"></a>00490         <a class="code" href="class_x_pulser.html#ef605744a25f80c3c052c889c24d0a54">qamOffset1</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00491"></a>00491         <a class="code" href="class_x_pulser.html#a9117e4ee8586d56a46ed7f138ac924a">qamOffset2</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00492"></a>00492         <a class="code" href="class_x_pulser.html#cb5233619e0f16cbfb859efef43a645f">qamLevel1</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00493"></a>00493         <a class="code" href="class_x_pulser.html#37c463677c246af6d57c0f15c41e5e64">qamLevel2</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00494"></a>00494         <a class="code" href="class_x_pulser.html#58eff26409df38012b819dd90302cb95">qamDelay1</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00495"></a>00495         <a class="code" href="class_x_pulser.html#c0beb6172f725e3c8b9500a6681771cb">qamDelay2</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00496"></a>00496         <a class="code" href="class_x_pulser.html#d2dee50865e4a00caf826cecad53ff28">difFreq</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00497"></a>00497         <a class="code" href="class_x_pulser.html#c55af557a7fe05cc1ddb73f4f71ebe39">induceEmission</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00498"></a>00498         <a class="code" href="class_x_pulser.html#f9ff61b1afe288bf418cef15b71f9a58">induceEmissionPhase</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00499"></a>00499         <a class="code" href="class_x_pulser.html#bdc8d6c38f94b72ff470b6fec3e8d70e">qswDelay</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00500"></a>00500         <a class="code" href="class_x_pulser.html#e8a0ff961e7dc409e36401a420c15d1f">qswWidth</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00501"></a>00501         <a class="code" href="class_x_pulser.html#c89a60d72422f3137af546ed03e23564">qswSoftSWOff</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00502"></a>00502         <a class="code" href="class_x_pulser.html#1adb52faaf96d006a19cd1e869bc4226">qswPiPulseOnly</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00503"></a>00503         <a class="code" href="class_x_pulser.html#49a059c26ad9e012c975f2f17e964068">invertPhase</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00504"></a>00504         <a class="code" href="class_x_pulser.html#0f1ebc0a1102325ffd0644cbe200c687">conserveStEPhase</a>()-&gt;setUIEnabled(<span class="keyword">false</span>);
<a name="l00505"></a>00505         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; NUM_DO_PORTS; i++) {
<a name="l00506"></a>00506 <span class="comment">//      m_portSel[i]-&gt;setUIEnabled(false);</span>
<a name="l00507"></a>00507                 <a class="code" href="class_x_pulser.html#5dcca525ffcb4c228238c6394ce718b9">m_portSel</a>[i]-&gt;<a class="code" href="class_x_node.html#88672dc755c34a4327adf096170f8290">setUIEnabled</a>(<span class="keyword">true</span>);
<a name="l00508"></a>00508         }
<a name="l00509"></a>00509   
<a name="l00510"></a>00510         afterStop();
<a name="l00511"></a>00511 <span class="comment">//    m_thread-&gt;waitFor();</span>
<a name="l00512"></a>00512 <span class="comment">//  thread must do interface()-&gt;close() at the end</span>
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="keyword">inline</span> <span class="keywordtype">double</span>
<a name="l00516"></a><a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">00516</a> <a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">XPulser::rintTermMilliSec</a>(<span class="keywordtype">double</span> msec)<span class="keyword"> const </span>{
<a name="l00517"></a>00517         <span class="keywordtype">double</span> res = <a class="code" href="class_x_pulser.html#6e9f9aba09706ad54f6d46c633144d79">resolution</a>();
<a name="l00518"></a>00518         <span class="keywordflow">return</span> rint(msec / res) * res;
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 <span class="keyword">inline</span> <span class="keywordtype">double</span>
<a name="l00521"></a><a class="code" href="class_x_pulser.html#72263e9c822d0733490870d6b4d042f1">00521</a> <a class="code" href="class_x_pulser.html#72263e9c822d0733490870d6b4d042f1">XPulser::rintTermMicroSec</a>(<span class="keywordtype">double</span> usec)<span class="keyword"> const </span>{
<a name="l00522"></a>00522         <span class="keywordtype">double</span> res = <a class="code" href="class_x_pulser.html#6e9f9aba09706ad54f6d46c633144d79">resolution</a>() * 1e3;
<a name="l00523"></a>00523         <span class="keywordflow">return</span> rint(usec / res) * res;
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 <span class="keyword">inline</span> uint64_t
<a name="l00526"></a><a class="code" href="class_x_pulser.html#1d3510e2af5d974f7541dd6f43faa8ee">00526</a> <a class="code" href="class_x_pulser.html#1d3510e2af5d974f7541dd6f43faa8ee">XPulser::ceilSampsMicroSec</a>(<span class="keywordtype">double</span> usec)<span class="keyword"> const </span>{
<a name="l00527"></a>00527         <span class="keywordtype">double</span> res = <a class="code" href="class_x_pulser.html#6e9f9aba09706ad54f6d46c633144d79">resolution</a>() * 1e3;
<a name="l00528"></a>00528         <span class="keywordflow">return</span> llrint(usec / res + 0.499);
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 <span class="keyword">inline</span> uint64_t
<a name="l00531"></a><a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">00531</a> <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">XPulser::rintSampsMicroSec</a>(<span class="keywordtype">double</span> usec)<span class="keyword"> const </span>{
<a name="l00532"></a>00532         <span class="keywordtype">double</span> res = <a class="code" href="class_x_pulser.html#6e9f9aba09706ad54f6d46c633144d79">resolution</a>() * 1e3;
<a name="l00533"></a>00533         <span class="keywordflow">return</span> llrint(usec / res);
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 <span class="keyword">inline</span> uint64_t
<a name="l00536"></a><a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">00536</a> <a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">XPulser::rintSampsMilliSec</a>(<span class="keywordtype">double</span> msec)<span class="keyword"> const </span>{
<a name="l00537"></a>00537         <span class="keywordtype">double</span> res = <a class="code" href="class_x_pulser.html#6e9f9aba09706ad54f6d46c633144d79">resolution</a>();
<a name="l00538"></a>00538         <span class="keywordflow">return</span> llrint(msec / res);
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 <span class="keywordtype">void</span>
<a name="l00541"></a><a class="code" href="class_x_pulser.html#630af391a20de6c3720f60c4cb095e14">00541</a> <a class="code" href="class_x_pulser.html#630af391a20de6c3720f60c4cb095e14">XPulser::analyzeRaw</a>() throw (XRecordError&amp;)
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543     <a class="code" href="class_x_pulser.html#b27d2a5d8d6a14117c9c9c45448e7a4b">m_combModeRecorded</a> = pop&lt;short&gt;();
<a name="l00544"></a>00544     pop&lt;short&gt;(); <span class="comment">//reserve</span>
<a name="l00545"></a>00545     <a class="code" href="class_x_pulser.html#c4a4c7a99362c51875593669b2c0cff2">m_rtimeRecorded</a> = pop&lt;double&gt;();
<a name="l00546"></a>00546     <a class="code" href="class_x_pulser.html#acaf2833e6777ea5a28350e0c3c0cb46">m_tauRecorded</a> = pop&lt;double&gt;();
<a name="l00547"></a>00547     <a class="code" href="class_x_pulser.html#ab8ac064848a132194fe9a0340fd3592">m_pw1Recorded</a> = pop&lt;double&gt;();
<a name="l00548"></a>00548     <a class="code" href="class_x_pulser.html#22d2bdf4806bff3d8b5e55e8618f38bd">m_pw2Recorded</a> = pop&lt;double&gt;();
<a name="l00549"></a>00549     <a class="code" href="class_x_pulser.html#ad51f58f35ef9c1744b3d8e6ad55cbf4">m_combP1Recorded</a> = pop&lt;double&gt;();
<a name="l00550"></a>00550     <a class="code" href="class_x_pulser.html#b8aa2e4fdcdc610cbc40f54ef3906797">m_altSepRecorded</a> = pop&lt;double&gt;();
<a name="l00551"></a>00551     <a class="code" href="class_x_pulser.html#813be78f449e4bef9b72578bbb9fba00">m_combP1AltRecorded</a> = pop&lt;double&gt;();
<a name="l00552"></a>00552     <a class="code" href="class_x_pulser.html#214702bc5e0ab65968386934e78e5732">m_aswSetupRecorded</a> = pop&lt;double&gt;();
<a name="l00553"></a>00553     <a class="code" href="class_x_pulser.html#f2d83a8fa19ebfc1d3f944fc05f77101">m_aswHoldRecorded</a> = pop&lt;double&gt;();
<a name="l00554"></a>00554     <span class="keywordflow">try</span> {
<a name="l00556"></a>00556         <a class="code" href="class_x_pulser.html#dee3f0d3ef10f1de01f88578b363b174">m_difFreqRecorded</a> = pop&lt;double&gt;();
<a name="l00557"></a>00557         <a class="code" href="class_x_pulser.html#eabdc69b7f169acfa272a8fbf0c30659">m_combPWRecorded</a> = pop&lt;double&gt;();
<a name="l00558"></a>00558         <a class="code" href="class_x_pulser.html#e1b3868e9b16557fbdfcd37f5b1c2263">m_combPTRecorded</a> = pop&lt;double&gt;();
<a name="l00559"></a>00559         <a class="code" href="class_x_pulser.html#60554c3892b9cb45437f5893059687ab">m_echoNumRecorded</a> = pop&lt;unsigned short&gt;();
<a name="l00560"></a>00560         <a class="code" href="class_x_pulser.html#64fa7cbbda32c7898e6776405d38cc17">m_combNumRecorded</a> = pop&lt;unsigned short&gt;();
<a name="l00561"></a>00561         <a class="code" href="class_x_pulser.html#5d0ba4dc79bd5cfabbd3050f0a781106">m_rtModeRecorded</a> = pop&lt;short&gt;();
<a name="l00562"></a>00562         <a class="code" href="class_x_pulser.html#3267117c99cecf657b0354db822beabf">m_numPhaseCycleRecorded</a> = pop&lt;unsigned short&gt;();
<a name="l00564"></a>00564         <a class="code" href="class_x_pulser.html#120557b186384884b262d2753f0ab350">m_invertPhaseRecorded</a> = pop&lt;unsigned short&gt;();
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566     <span class="keywordflow">catch</span> (XRecordError &amp;) {
<a name="l00567"></a>00567         <a class="code" href="class_x_pulser.html#dee3f0d3ef10f1de01f88578b363b174">m_difFreqRecorded</a> = *<a class="code" href="class_x_pulser.html#d2dee50865e4a00caf826cecad53ff28">difFreq</a>();
<a name="l00568"></a>00568         <a class="code" href="class_x_pulser.html#eabdc69b7f169acfa272a8fbf0c30659">m_combPWRecorded</a> = *<a class="code" href="class_x_pulser.html#8dfd04875fd1ad4985532e9cd0c26022">combPW</a>();
<a name="l00569"></a>00569         <a class="code" href="class_x_pulser.html#e1b3868e9b16557fbdfcd37f5b1c2263">m_combPTRecorded</a> = *<a class="code" href="class_x_pulser.html#6dfc9c71c0dffc489eaf59892c4d228e">combPT</a>();
<a name="l00570"></a>00570         <a class="code" href="class_x_pulser.html#60554c3892b9cb45437f5893059687ab">m_echoNumRecorded</a> = *<a class="code" href="class_x_pulser.html#8463ec3d3386ceb345171cf1d516a883">echoNum</a>();
<a name="l00571"></a>00571         <a class="code" href="class_x_pulser.html#64fa7cbbda32c7898e6776405d38cc17">m_combNumRecorded</a> = *<a class="code" href="class_x_pulser.html#9b057f3a0ab711bbb1b40e8e88155d62">combNum</a>();
<a name="l00572"></a>00572         <a class="code" href="class_x_pulser.html#5d0ba4dc79bd5cfabbd3050f0a781106">m_rtModeRecorded</a> = *<a class="code" href="class_x_pulser.html#217bba681cbf8b302ed7e7ed9a69b5d0">rtMode</a>();
<a name="l00573"></a>00573                 <span class="keywordtype">int</span> npat = 16;
<a name="l00574"></a>00574                 <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_1) npat = 1;
<a name="l00575"></a>00575                 <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_2) npat = 2;
<a name="l00576"></a>00576                 <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_4) npat = 4;
<a name="l00577"></a>00577                 <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_8) npat = 8;
<a name="l00578"></a>00578                 <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_16) npat = 16;
<a name="l00579"></a>00579         <a class="code" href="class_x_pulser.html#3267117c99cecf657b0354db822beabf">m_numPhaseCycleRecorded</a> = npat;
<a name="l00580"></a>00580         <a class="code" href="class_x_pulser.html#120557b186384884b262d2753f0ab350">m_invertPhaseRecorded</a> = 0.0;
<a name="l00581"></a>00581     }    
<a name="l00582"></a>00582     <a class="code" href="class_x_pulser.html#69071f807517a8cc831eeda75b885d4d">rawToRelPat</a>();
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 <span class="keywordtype">void</span>
<a name="l00586"></a><a class="code" href="class_x_pulser.html#600f08daaae8338b32ec6bd6c33f1db7">00586</a> <a class="code" href="class_x_pulser.html#600f08daaae8338b32ec6bd6c33f1db7">XPulser::visualize</a>()
<a name="l00587"></a>00587 {
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="keywordtype">void</span>
<a name="l00593"></a><a class="code" href="class_x_pulser.html#8a9b598541d0d98a19be4a8af5df29fb">00593</a> <a class="code" href="class_x_pulser.html#8a9b598541d0d98a19be4a8af5df29fb">XPulser::onPulseChanged</a>(<span class="keyword">const</span> shared_ptr&lt;XValueNodeBase&gt; &amp;node)
<a name="l00594"></a>00594 {
<a name="l00595"></a>00595         <a class="code" href="class_x_time.html">XTime</a> time_awared = <a class="code" href="class_x_time.html#c379a0eebc8202c724609985cf7782ac">XTime::now</a>();
<a name="l00596"></a>00596   
<a name="l00597"></a>00597         <span class="keyword">const</span> <span class="keywordtype">double</span> _tau = <a class="code" href="class_x_pulser.html#72263e9c822d0733490870d6b4d042f1">rintTermMicroSec</a>(*<a class="code" href="class_x_pulser.html#a6f062ffe966922d8fea2ab9264b8e1c">tau</a>());
<a name="l00598"></a>00598         <span class="keyword">const</span> <span class="keywordtype">double</span> _asw_setup = <a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">rintTermMilliSec</a>(*<a class="code" href="class_x_pulser.html#939e9859fa6a244076e2930764aecd88">aswSetup</a>());
<a name="l00599"></a>00599         <span class="keyword">const</span> <span class="keywordtype">double</span> _asw_hold = <a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">rintTermMilliSec</a>(*<a class="code" href="class_x_pulser.html#5250fe217ada95071161c7012f1eea26">aswHold</a>());
<a name="l00600"></a>00600         <span class="keyword">const</span> <span class="keywordtype">double</span> _alt_sep = <a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">rintTermMilliSec</a>(*<a class="code" href="class_x_pulser.html#9d4cbdaeb611c148f157c7c2de18a967">altSep</a>());
<a name="l00601"></a>00601         <span class="keyword">const</span> <span class="keywordtype">int</span> _echo_num = *<a class="code" href="class_x_pulser.html#8463ec3d3386ceb345171cf1d516a883">echoNum</a>();
<a name="l00602"></a>00602         <span class="keywordflow">if</span>(_asw_setup &gt; 2.0 * _tau)
<a name="l00603"></a>00603                 <a class="code" href="class_x_pulser.html#939e9859fa6a244076e2930764aecd88">aswSetup</a>()-&gt;value(2.0 * _tau);
<a name="l00604"></a>00604         <span class="keywordflow">if</span>(node != <a class="code" href="class_x_pulser.html#9d4cbdaeb611c148f157c7c2de18a967">altSep</a>())
<a name="l00605"></a>00605                 <span class="keywordflow">if</span>(_alt_sep != _asw_setup + _asw_hold + (_echo_num - 1) * 2 * _tau/1000)
<a name="l00606"></a>00606                 {
<a name="l00607"></a>00607                         <a class="code" href="class_x_pulser.html#9d4cbdaeb611c148f157c7c2de18a967">altSep</a>()-&gt;value(_asw_setup + _asw_hold + (_echo_num - 1) * 2 * _tau/1000);
<a name="l00608"></a>00608                         <span class="keywordflow">return</span>;
<a name="l00609"></a>00609                 }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611         <a class="code" href="class_x_primary_driver.html#96f11456afe35d94890107edf261ec35">clearRaw</a>();
<a name="l00612"></a>00612 
<a name="l00613"></a>00613         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> blankpattern = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_COMB_FM);
<a name="l00614"></a>00614   
<a name="l00615"></a>00615         <span class="keywordflow">if</span>(!*<a class="code" href="class_x_pulser.html#7ecb8e6c23e19a846e64b94daf24bba6">output</a>())
<a name="l00616"></a>00616         {
<a name="l00617"></a>00617                 <a class="code" href="class_x_primary_driver.html#c6e36b570ea5e17d23e96252524d0407">finishWritingRaw</a>(<a class="code" href="class_x_time.html">XTime</a>(), <a class="code" href="class_x_time.html">XTime</a>());
<a name="l00618"></a>00618                 <span class="keywordflow">try</span> {
<a name="l00619"></a>00619                         <a class="code" href="class_x_pulser.html#c8c6173c2d6d8bf5b3470c75aabe8883">changeOutput</a>(<span class="keyword">false</span>, blankpattern);
<a name="l00620"></a>00620                 }
<a name="l00621"></a>00621                 <span class="keywordflow">catch</span> (<a class="code" href="struct_x_kame_error.html">XKameError</a> &amp;e) {
<a name="l00622"></a>00622                         e.<a class="code" href="struct_x_kame_error.html#9a84ebcb9d45b52654fd1d071450a5ee">print</a>(<a class="code" href="class_x_node.html#84f0935a406e8f16042f80b9dcaaa722">getLabel</a>() + <a class="code" href="namespace_k_a_m_e.html#2773169baae29cb1a051baaef534fb63">KAME::i18n</a>(<span class="stringliteral">"Pulser Turn-Off Failed, because"</span>));
<a name="l00623"></a>00623                 }
<a name="l00624"></a>00624                 <span class="keywordflow">return</span>;
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627 <span class="comment">/*  try {</span>
<a name="l00628"></a>00628 <span class="comment">        changeOutput(false, blankpattern);</span>
<a name="l00629"></a>00629 <span class="comment">        }</span>
<a name="l00630"></a>00630 <span class="comment">        catch (XKameError &amp;e) {</span>
<a name="l00631"></a>00631 <span class="comment">        e.print(getLabel() + KAME::i18n("Pulser Turn-Off Failed, because"));</span>
<a name="l00632"></a>00632 <span class="comment">        return;</span>
<a name="l00633"></a>00633 <span class="comment">        }</span>
<a name="l00634"></a>00634 <span class="comment">*/</span>    
<a name="l00636"></a>00636     push((<span class="keywordtype">short</span>)*<a class="code" href="class_x_pulser.html#e3adfc50a6471f9a589006d0b655d916">combMode</a>());
<a name="l00637"></a>00637     push((<span class="keywordtype">short</span>)0); <span class="comment">//reserve</span>
<a name="l00638"></a>00638     push((<span class="keywordtype">double</span>)<a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">rintTermMilliSec</a>(*<a class="code" href="class_x_pulser.html#a40be34d289d1e39d690c0db7db069cc">rtime</a>()));
<a name="l00639"></a>00639     push((<span class="keywordtype">double</span>)_tau);
<a name="l00640"></a>00640     push((<span class="keywordtype">double</span>)*<a class="code" href="class_x_pulser.html#a81f96b8006b7b78b513ddd1678fd9b6">pw1</a>());
<a name="l00641"></a>00641     push((<span class="keywordtype">double</span>)*<a class="code" href="class_x_pulser.html#0ef1c2cf73493e9f91fbc30408aea170">pw2</a>());
<a name="l00642"></a>00642     push((<span class="keywordtype">double</span>)<a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">rintTermMilliSec</a>(*<a class="code" href="class_x_pulser.html#a14c52a1ede57762c1603d841a8efb66">combP1</a>()));
<a name="l00643"></a>00643     push((<span class="keywordtype">double</span>)_alt_sep);
<a name="l00644"></a>00644     push((<span class="keywordtype">double</span>)<a class="code" href="class_x_pulser.html#23b9262e9dd7c869c15b265ae86eb132">rintTermMilliSec</a>(*<a class="code" href="class_x_pulser.html#83bb50884c71ab57ec1f1fb304afa8d3">combP1Alt</a>()));
<a name="l00645"></a>00645     push((<span class="keywordtype">double</span>)_asw_setup);
<a name="l00646"></a>00646     push((<span class="keywordtype">double</span>)_asw_hold);
<a name="l00648"></a>00648     push((<span class="keywordtype">double</span>)*<a class="code" href="class_x_pulser.html#d2dee50865e4a00caf826cecad53ff28">difFreq</a>());
<a name="l00649"></a>00649     push((<span class="keywordtype">double</span>)*<a class="code" href="class_x_pulser.html#8dfd04875fd1ad4985532e9cd0c26022">combPW</a>());
<a name="l00650"></a>00650     push((<span class="keywordtype">double</span>)<a class="code" href="class_x_pulser.html#72263e9c822d0733490870d6b4d042f1">rintTermMicroSec</a>(*<a class="code" href="class_x_pulser.html#6dfc9c71c0dffc489eaf59892c4d228e">combPT</a>()));
<a name="l00651"></a>00651     push((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)*<a class="code" href="class_x_pulser.html#8463ec3d3386ceb345171cf1d516a883">echoNum</a>());
<a name="l00652"></a>00652     push((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)*<a class="code" href="class_x_pulser.html#9b057f3a0ab711bbb1b40e8e88155d62">combNum</a>());
<a name="l00653"></a>00653     push((<span class="keywordtype">short</span>)*<a class="code" href="class_x_pulser.html#217bba681cbf8b302ed7e7ed9a69b5d0">rtMode</a>());
<a name="l00654"></a>00654         <span class="keywordtype">int</span> npat = 16;
<a name="l00655"></a>00655         <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_1) npat = 1;
<a name="l00656"></a>00656         <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_2) npat = 2;
<a name="l00657"></a>00657         <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_4) npat = 4;
<a name="l00658"></a>00658         <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_8) npat = 8;
<a name="l00659"></a>00659         <span class="keywordflow">if</span>(<a class="code" href="class_x_pulser.html#103c117aad8e126f1c8f4d3dafef39b2">numPhaseCycle</a>()-&gt;to_str() == NUM_PHASE_CYCLE_16) npat = 16;
<a name="l00660"></a>00660         push((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)npat);
<a name="l00662"></a>00662     push((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)*<a class="code" href="class_x_pulser.html#49a059c26ad9e012c975f2f17e964068">invertPhase</a>());
<a name="l00663"></a>00663 
<a name="l00664"></a>00664         <a class="code" href="class_x_primary_driver.html#c6e36b570ea5e17d23e96252524d0407">finishWritingRaw</a>(time_awared, <a class="code" href="class_x_time.html#c379a0eebc8202c724609985cf7782ac">XTime::now</a>());
<a name="l00665"></a>00665   
<a name="l00666"></a>00666         <span class="keywordflow">try</span> {
<a name="l00667"></a>00667                 <a class="code" href="class_x_pulser.html#b241e386659de56bf5adc4fb605ae763">createNativePatterns</a>();
<a name="l00668"></a>00668                 <a class="code" href="class_x_pulser.html#c8c6173c2d6d8bf5b3470c75aabe8883">changeOutput</a>(<span class="keyword">true</span>, blankpattern);
<a name="l00669"></a>00669         }
<a name="l00670"></a>00670         <span class="keywordflow">catch</span> (<a class="code" href="struct_x_kame_error.html">XKameError</a> &amp;e) {
<a name="l00671"></a>00671                 e.<a class="code" href="struct_x_kame_error.html#9a84ebcb9d45b52654fd1d071450a5ee">print</a>(<a class="code" href="class_x_node.html#84f0935a406e8f16042f80b9dcaaa722">getLabel</a>() + <a class="code" href="namespace_k_a_m_e.html#2773169baae29cb1a051baaef534fb63">KAME::i18n</a>(<span class="stringliteral">"Pulser Turn-On Failed, because"</span>));
<a name="l00672"></a>00672         } 
<a name="l00673"></a>00673 }
<a name="l00674"></a>00674 <span class="keywordtype">double</span>
<a name="l00675"></a><a class="code" href="class_x_pulser.html#2667c108199ad08df9dafafb420f290f">00675</a> <a class="code" href="class_x_pulser.html#2667c108199ad08df9dafafb420f290f">XPulser::periodicTermRecorded</a>()<span class="keyword"> const </span>{
<a name="l00676"></a>00676     ASSERT(!<a class="code" href="class_x_pulser.html#e1852ccdf7c6a475d8f03537e95b9da9">m_relPatList</a>.empty());
<a name="l00677"></a>00677     <span class="keywordflow">return</span> <a class="code" href="class_x_pulser.html#e1852ccdf7c6a475d8f03537e95b9da9">m_relPatList</a>.back().time;
<a name="l00678"></a>00678 }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00681"></a>00681 <span class="comment">//A pettern at absolute time</span>
<a name="l00682"></a><a class="code" href="classtpat.html">00682</a> <span class="keyword">class </span><a class="code" href="classtpat.html">tpat</a> {
<a name="l00683"></a>00683 <span class="keyword">public</span>:
<a name="l00684"></a><a class="code" href="classtpat.html#5bb0e5077b2a991a3c778110d525b759">00684</a>         <a class="code" href="classtpat.html#5bb0e5077b2a991a3c778110d525b759">tpat</a>(uint64_t npos, uint32_t newpat, uint32_t nmask) {
<a name="l00685"></a>00685                 <a class="code" href="classtpat.html#e352ca64181fdc2a7e0b19e21c8ea464">pos</a> = npos; <a class="code" href="classtpat.html#e89062c98d6c05e709af7cbe02bd9154">pat</a> = newpat; <a class="code" href="classtpat.html#010287b0c9f33db65e912cf66098a5ae">mask</a> = nmask;
<a name="l00686"></a>00686         }
<a name="l00687"></a><a class="code" href="classtpat.html#218caf8134c337c8e86a2270be97c8bc">00687</a>         <a class="code" href="classtpat.html#5bb0e5077b2a991a3c778110d525b759">tpat</a>(<span class="keyword">const</span> <a class="code" href="classtpat.html">tpat</a> &amp;x) {
<a name="l00688"></a>00688                 <a class="code" href="classtpat.html#e352ca64181fdc2a7e0b19e21c8ea464">pos</a> = x.<a class="code" href="classtpat.html#e352ca64181fdc2a7e0b19e21c8ea464">pos</a>; <a class="code" href="classtpat.html#e89062c98d6c05e709af7cbe02bd9154">pat</a> = x.<a class="code" href="classtpat.html#e89062c98d6c05e709af7cbe02bd9154">pat</a>; <a class="code" href="classtpat.html#010287b0c9f33db65e912cf66098a5ae">mask</a> = x.<a class="code" href="classtpat.html#010287b0c9f33db65e912cf66098a5ae">mask</a>;
<a name="l00689"></a>00689         }
<a name="l00690"></a><a class="code" href="classtpat.html#e352ca64181fdc2a7e0b19e21c8ea464">00690</a>         uint64_t <a class="code" href="classtpat.html#e352ca64181fdc2a7e0b19e21c8ea464">pos</a>;
<a name="l00691"></a>00691         <span class="comment">//this pattern bits will be outputted at 'pos'</span>
<a name="l00692"></a><a class="code" href="classtpat.html#e89062c98d6c05e709af7cbe02bd9154">00692</a>         uint32_t <a class="code" href="classtpat.html#e89062c98d6c05e709af7cbe02bd9154">pat</a>;
<a name="l00693"></a>00693         <span class="comment">//mask bits</span>
<a name="l00694"></a><a class="code" href="classtpat.html#010287b0c9f33db65e912cf66098a5ae">00694</a>         uint32_t <a class="code" href="classtpat.html#010287b0c9f33db65e912cf66098a5ae">mask</a>;
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="classtpat.html#4b9e05239d0c1114e7152e67f8319ac1">00696</a>         <span class="keywordtype">bool</span> <a class="code" href="classtpat.html#4b9e05239d0c1114e7152e67f8319ac1">operator&lt; </a>(<span class="keyword">const</span> <a class="code" href="classtpat.html">tpat</a> &amp;y)<span class="keyword"> const </span>{
<a name="l00697"></a>00697                 <span class="keywordflow">return</span> <a class="code" href="classtpat.html#e352ca64181fdc2a7e0b19e21c8ea464">pos</a> &lt; y.<a class="code" href="classtpat.html#e352ca64181fdc2a7e0b19e21c8ea464">pos</a>;
<a name="l00698"></a>00698         }          
<a name="l00699"></a>00699 }; 
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
<a name="l00702"></a><a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">00702</a> <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">XPulser::selectedPorts</a>(<span class="keywordtype">int</span> func)<span class="keyword"> const</span>
<a name="l00703"></a>00703 <span class="keyword"></span>{
<a name="l00704"></a>00704         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mask = 0;
<a name="l00705"></a>00705         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; NUM_DO_PORTS; i++) {
<a name="l00706"></a>00706                 <span class="keywordflow">if</span>(*<a class="code" href="class_x_pulser.html#da5f4424954fd54ef511d5bc3b2bcf05">portSel</a>(i) == func)
<a name="l00707"></a>00707                         mask |= 1 &lt;&lt; i;
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709         <span class="keywordflow">return</span> mask;
<a name="l00710"></a>00710 }
<a name="l00711"></a>00711 <span class="keywordtype">void</span>
<a name="l00712"></a><a class="code" href="class_x_pulser.html#69071f807517a8cc831eeda75b885d4d">00712</a> <a class="code" href="class_x_pulser.html#69071f807517a8cc831eeda75b885d4d">XPulser::rawToRelPat</a>() throw (XRecordError&amp;)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> g3mask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_GATE3);
<a name="l00715"></a>00715         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> g2mask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_PREGATE);
<a name="l00716"></a>00716         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> g1mask = (<a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_GATE) | g3mask);
<a name="l00717"></a>00717         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> trig1mask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_TRIG1);
<a name="l00718"></a>00718         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> trig2mask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_TRIG2);
<a name="l00719"></a>00719         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> aswmask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_ASW);
<a name="l00720"></a>00720         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qswmask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_QSW);
<a name="l00721"></a>00721         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pulse1mask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_PULSE1);
<a name="l00722"></a>00722         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pulse2mask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_PULSE2);
<a name="l00723"></a>00723         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> combmask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_COMB);
<a name="l00724"></a>00724         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> combfmmask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_COMB_FM);
<a name="l00725"></a>00725         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskamask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_QPSK_A);
<a name="l00726"></a>00726         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskbmask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_QPSK_B);
<a name="l00727"></a>00727         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpsknoninvmask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_QPSK_OLD_NONINV);
<a name="l00728"></a>00728         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskinvmask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_QPSK_OLD_INV);
<a name="l00729"></a>00729         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskpsgatemask = <a class="code" href="class_x_pulser.html#e08b19a82ed850465dc66f85726271e8">selectedPorts</a>(PORTSEL_QPSK_OLD_PSGATE);
<a name="l00730"></a>00730         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskmask = qpskamask | qpskbmask |
<a name="l00731"></a>00731                 qpskinvmask | qpsknoninvmask | qpskpsgatemask | PAT_QAM_PHASE_MASK;
<a name="l00732"></a>00732         
<a name="l00733"></a>00733         uint64_t _rtime = <a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">rintSampsMilliSec</a>(<a class="code" href="class_x_pulser.html#c4a4c7a99362c51875593669b2c0cff2">m_rtimeRecorded</a>);
<a name="l00734"></a>00734         uint64_t _tau = <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#acaf2833e6777ea5a28350e0c3c0cb46">m_tauRecorded</a>);
<a name="l00735"></a>00735         uint64_t _asw_setup = <a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">rintSampsMilliSec</a>(<a class="code" href="class_x_pulser.html#214702bc5e0ab65968386934e78e5732">m_aswSetupRecorded</a>);
<a name="l00736"></a>00736         uint64_t _asw_hold = <a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">rintSampsMilliSec</a>(<a class="code" href="class_x_pulser.html#f2d83a8fa19ebfc1d3f944fc05f77101">m_aswHoldRecorded</a>);
<a name="l00737"></a>00737         uint64_t _alt_sep = <a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">rintSampsMilliSec</a>(<a class="code" href="class_x_pulser.html#b8aa2e4fdcdc610cbc40f54ef3906797">m_altSepRecorded</a>);
<a name="l00738"></a>00738         uint64_t _pw1 = <a class="code" href="class_x_pulser.html#c60d17dc4ad6e70a13c201daa2dc197d">haveQAMPorts</a>() ? 
<a name="l00739"></a>00739                 <a class="code" href="class_x_pulser.html#1d3510e2af5d974f7541dd6f43faa8ee">ceilSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#ab8ac064848a132194fe9a0340fd3592">m_pw1Recorded</a>/2)*2 : <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#ab8ac064848a132194fe9a0340fd3592">m_pw1Recorded</a>/2)*2;
<a name="l00740"></a>00740         uint64_t _pw2 = <a class="code" href="class_x_pulser.html#c60d17dc4ad6e70a13c201daa2dc197d">haveQAMPorts</a>() ?
<a name="l00741"></a>00741                 <a class="code" href="class_x_pulser.html#1d3510e2af5d974f7541dd6f43faa8ee">ceilSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#22d2bdf4806bff3d8b5e55e8618f38bd">m_pw2Recorded</a>/2)*2 : <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#22d2bdf4806bff3d8b5e55e8618f38bd">m_pw2Recorded</a>/2)*2;
<a name="l00742"></a>00742         uint64_t _comb_pw = <a class="code" href="class_x_pulser.html#c60d17dc4ad6e70a13c201daa2dc197d">haveQAMPorts</a>() ?
<a name="l00743"></a>00743                 <a class="code" href="class_x_pulser.html#1d3510e2af5d974f7541dd6f43faa8ee">ceilSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#eabdc69b7f169acfa272a8fbf0c30659">m_combPWRecorded</a>/2)*2 : <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#eabdc69b7f169acfa272a8fbf0c30659">m_combPWRecorded</a>/2)*2;
<a name="l00744"></a>00744         uint64_t _comb_pt = <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(<a class="code" href="class_x_pulser.html#e1b3868e9b16557fbdfcd37f5b1c2263">m_combPTRecorded</a>);
<a name="l00745"></a>00745         uint64_t _comb_p1 = <a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">rintSampsMilliSec</a>(<a class="code" href="class_x_pulser.html#ad51f58f35ef9c1744b3d8e6ad55cbf4">m_combP1Recorded</a>);
<a name="l00746"></a>00746         uint64_t _comb_p1_alt = <a class="code" href="class_x_pulser.html#200106e3316c576ac1db10504d4e3145">rintSampsMilliSec</a>(<a class="code" href="class_x_pulser.html#813be78f449e4bef9b72578bbb9fba00">m_combP1AltRecorded</a>);
<a name="l00747"></a>00747         uint64_t _g2_setup = <a class="code" href="class_x_pulser.html#1d3510e2af5d974f7541dd6f43faa8ee">ceilSampsMicroSec</a>(*<a class="code" href="class_x_pulser.html#9718f99086c9408e2e3977fe31eb2bcd">g2Setup</a>());
<a name="l00748"></a>00748         <span class="keywordtype">int</span> _echo_num = <a class="code" href="class_x_pulser.html#60554c3892b9cb45437f5893059687ab">m_echoNumRecorded</a>;
<a name="l00749"></a>00749         <span class="keywordtype">int</span> _comb_num = <a class="code" href="class_x_pulser.html#64fa7cbbda32c7898e6776405d38cc17">m_combNumRecorded</a>;
<a name="l00750"></a>00750         <span class="keywordtype">int</span> _comb_mode = <a class="code" href="class_x_pulser.html#b27d2a5d8d6a14117c9c9c45448e7a4b">m_combModeRecorded</a>;
<a name="l00751"></a>00751         <span class="keywordtype">int</span> _rt_mode = <a class="code" href="class_x_pulser.html#5d0ba4dc79bd5cfabbd3050f0a781106">m_rtModeRecorded</a>;
<a name="l00752"></a>00752         <span class="keywordtype">int</span> _num_phase_cycle = <a class="code" href="class_x_pulser.html#3267117c99cecf657b0354db822beabf">m_numPhaseCycleRecorded</a>;
<a name="l00753"></a>00753   
<a name="l00754"></a>00754         <span class="keywordtype">bool</span> comb_mode_alt = ((_comb_mode == N_COMB_MODE_P1_ALT) ||
<a name="l00755"></a>00755                                                                 (_comb_mode == N_COMB_MODE_COMB_ALT));
<a name="l00756"></a>00756         <span class="keywordtype">bool</span> saturation_wo_comb = (_comb_num == 0);
<a name="l00757"></a>00757         <span class="keywordtype">bool</span> driven_equilibrium = *<a class="code" href="class_x_pulser.html#02de09864e63ba9b002e329b02b0255c">drivenEquilibrium</a>();
<a name="l00758"></a>00758         uint64_t _qsw_delay = <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(*<a class="code" href="class_x_pulser.html#bdc8d6c38f94b72ff470b6fec3e8d70e">qswDelay</a>());
<a name="l00759"></a>00759         uint64_t _qsw_width = <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(*<a class="code" href="class_x_pulser.html#e8a0ff961e7dc409e36401a420c15d1f">qswWidth</a>());
<a name="l00760"></a>00760         uint64_t _qsw_softswoff = std::min(_qsw_width, <a class="code" href="class_x_pulser.html#0c063ce2fc779f5451818b30c493934e">rintSampsMicroSec</a>(*<a class="code" href="class_x_pulser.html#c89a60d72422f3137af546ed03e23564">qswSoftSWOff</a>()));
<a name="l00761"></a>00761         <span class="keywordtype">bool</span> _qsw_pi_only = *<a class="code" href="class_x_pulser.html#1adb52faaf96d006a19cd1e869bc4226">qswPiPulseOnly</a>();
<a name="l00762"></a>00762         <span class="keywordtype">int</span> comb_rot_num = lrint(*<a class="code" href="class_x_pulser.html#44778cb0f8708d070f3b61efdf108563">combOffRes</a>() * (<a class="code" href="class_x_pulser.html#eabdc69b7f169acfa272a8fbf0c30659">m_combPWRecorded</a> / 1000.0 * 4));
<a name="l00763"></a>00763   
<a name="l00764"></a>00764         <span class="keywordtype">bool</span> _induce_emission = *<a class="code" href="class_x_pulser.html#c55af557a7fe05cc1ddb73f4f71ebe39">induceEmission</a>();
<a name="l00765"></a>00765         uint64_t _induce_emission_pw = _comb_pw;
<a name="l00766"></a>00766         <span class="keywordflow">if</span>((_comb_mode == N_COMB_MODE_OFF))
<a name="l00767"></a>00767                 _num_phase_cycle = std::min(_num_phase_cycle, 4);
<a name="l00768"></a>00768   
<a name="l00769"></a>00769         <span class="keywordtype">bool</span> _invert_phase = <a class="code" href="class_x_pulser.html#120557b186384884b262d2753f0ab350">m_invertPhaseRecorded</a>;
<a name="l00770"></a>00770         <span class="keywordtype">bool</span> _conserve_ste_phase = *<a class="code" href="class_x_pulser.html#0f1ebc0a1102325ffd0644cbe200c687">conserveStEPhase</a>();
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="comment">//patterns correspoinding to 0, pi/2, pi, -pi/2</span>
<a name="l00773"></a>00773         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskIQ[4] = {0, 1, 3, 2};
<a name="l00774"></a>00774         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskOLD[4] = {2, 3, 4, 5};
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="comment">//unit of phase is pi/2</span>
<a name="l00777"></a>00777 <span class="preprocessor">#define __qpsk(phase) ((((phase) + (_invert_phase ? 2 : 0)) % 4))</span>
<a name="l00778"></a>00778 <span class="preprocessor"></span><span class="preprocessor">#define _qpsk(phase)  ( \</span>
<a name="l00779"></a>00779 <span class="preprocessor">        ((qpskIQ[__qpsk(phase)] &amp; 1) ? qpskamask : 0) | \</span>
<a name="l00780"></a>00780 <span class="preprocessor">        ((qpskIQ[__qpsk(phase)] &amp; 2) ? qpskbmask : 0) | \</span>
<a name="l00781"></a>00781 <span class="preprocessor">        ((qpskOLD[__qpsk(phase)] &amp; 1) ? qpskpsgatemask : 0) | \</span>
<a name="l00782"></a>00782 <span class="preprocessor">        ((qpskOLD[__qpsk(phase)] &amp; 2) ? qpsknoninvmask : 0) | \</span>
<a name="l00783"></a>00783 <span class="preprocessor">        ((qpskOLD[__qpsk(phase)] &amp; 4) ? qpskinvmask : 0) | \</span>
<a name="l00784"></a>00784 <span class="preprocessor">        (__qpsk(phase) * PAT_QAM_PHASE))</span>
<a name="l00785"></a>00785 <span class="preprocessor"></span>        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpsk[4] = {_qpsk(0), _qpsk(1), _qpsk(2), _qpsk(3)};
<a name="l00786"></a>00786         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> qpskinv[4] = {_qpsk(2), _qpsk(3), _qpsk(0), _qpsk(1)};
<a name="l00787"></a>00787 
<a name="l00788"></a>00788         <span class="comment">//comb phases</span>
<a name="l00789"></a>00789         <span class="keyword">const</span> uint32_t comb_ste_cancel[MAX_NUM_PHASE_CYCLE] = {
<a name="l00790"></a>00790                 1, 3, 0, 2, 3, 1, 2, 0, 0, 2, 1, 3, 2, 0, 3, 1
<a name="l00791"></a>00791         };
<a name="l00792"></a>00792         <span class="comment">//induced emission phases</span>
<a name="l00793"></a>00793         <span class="keyword">const</span> uint32_t pindem[MAX_NUM_PHASE_CYCLE] = {
<a name="l00794"></a>00794                 0, 0, 0, 0, 2, 2, 2, 2, 0, 0, 0, 0, 2, 2, 2, 2
<a name="l00795"></a>00795         };
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <span class="comment">//pi/2 pulse phases</span>
<a name="l00798"></a>00798         <span class="keyword">const</span> uint32_t p1single[MAX_NUM_PHASE_CYCLE] = {
<a name="l00799"></a>00799                 0, 0, 2, 2, 0, 0, 2, 2, 0, 0, 2, 2, 0, 0, 2, 2
<a name="l00800"></a>00800         };
<a name="l00801"></a>00801         <span class="comment">//pi pulse phases</span>
<a name="l00802"></a>00802         <span class="keyword">const</span> uint32_t p2single[MAX_NUM_PHASE_CYCLE] = {
<a name="l00803"></a>00803                 0, 2, 1, 3, 0, 2, 1, 3, 0, 2, 1, 3, 0, 2, 1, 3
<a name="l00804"></a>00804         };
<a name="l00805"></a>00805 
<a name="l00806"></a>00806         <span class="comment">//pi/2 pulse phases for multiple echoes</span>
<a name="l00807"></a>00807         <span class="keyword">const</span> uint32_t p1multi[MAX_NUM_PHASE_CYCLE] = {
<a name="l00808"></a>00808                 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2
<a name="l00809"></a>00809         };
<a name="l00810"></a>00810         <span class="comment">//pi pulse phases for multiple echoes or for st.e.</span>
<a name="l00811"></a>00811         <span class="keyword">const</span> uint32_t p2multi[MAX_NUM_PHASE_CYCLE] = {
<a name="l00812"></a>00812                 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3
<a name="l00813"></a>00813         };
<a name="l00814"></a>00814         <span class="comment">//stimulated echo pulse phases</span>
<a name="l00815"></a>00815         <span class="keyword">const</span> uint32_t ste_p1[MAX_NUM_PHASE_CYCLE] = {
<a name="l00816"></a>00816                 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
<a name="l00817"></a>00817         };
<a name="l00818"></a>00818         <span class="keyword">const</span> uint32_t ste_p2[MAX_NUM_PHASE_CYCLE] = {
<a name="l00819"></a>00819                 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3
<a name="l00820"></a>00820         };
<a name="l00821"></a>00821   
<a name="l00822"></a>00822         <span class="keyword">const</span> uint32_t _qpsk_driven_equilibrium[4] = {2, 1, 0, 3};
<a name="l00823"></a>00823 <span class="preprocessor">#define qpsk_driven_equilibrium(phase) qpsk[_qpsk_driven_equilibrium[(phase) % 4]]</span>
<a name="l00824"></a>00824 <span class="preprocessor"></span><span class="preprocessor">#define qpsk_driven_equilibrium_inv(phase) (qpsk_driven_equilibrium(((phase) + 2) % 4))</span>
<a name="l00825"></a>00825 <span class="preprocessor"></span>
<a name="l00826"></a>00826         <span class="keyword">typedef</span> std::multiset&lt;tpat, std::less&lt;tpat&gt; &gt; tpatset;
<a name="l00827"></a>00827         tpatset patterns;  <span class="comment">// patterns</span>
<a name="l00828"></a>00828         tpatset patterns_cheap; <span class="comment">//Low priority patterns</span>
<a name="l00829"></a>00829         <span class="keyword">typedef</span> std::multiset&lt;tpat, std::less&lt;tpat&gt; &gt;::iterator tpatset_it;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <a class="code" href="class_x_pulser.html#e1852ccdf7c6a475d8f03537e95b9da9">m_relPatList</a>.clear();
<a name="l00832"></a>00832   
<a name="l00833"></a>00833         uint64_t pos = 0;
<a name="l00834"></a>00834             
<a name="l00835"></a>00835         <span class="keywordtype">int</span> echonum = _echo_num;
<a name="l00836"></a>00836         <span class="keyword">const</span> uint32_t *p1 = ((echonum &gt; 1) || _conserve_ste_phase) ? p1multi : p1single;
<a name="l00837"></a>00837         <span class="keyword">const</span> uint32_t *p2 = ((echonum &gt; 1) || _conserve_ste_phase) ? p2multi : p2single;
<a name="l00838"></a>00838   
<a name="l00839"></a>00839         <span class="keywordtype">bool</span> former_of_alt = !_invert_phase;
<a name="l00840"></a>00840         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _num_phase_cycle * (comb_mode_alt ? 2 : 1); i++)
<a name="l00841"></a>00841         {
<a name="l00842"></a>00842                 <span class="keywordtype">int</span> j = (i / (comb_mode_alt ? 2 : 1)) % _num_phase_cycle; <span class="comment">//index for phase cycling</span>
<a name="l00843"></a>00843                 <span class="keywordflow">if</span>(_invert_phase)
<a name="l00844"></a>00844                         j = _num_phase_cycle - 1 - j;
<a name="l00845"></a>00845                 former_of_alt = !former_of_alt;
<a name="l00846"></a>00846                 <span class="keywordtype">bool</span> comb_off_res = ((_comb_mode != N_COMB_MODE_COMB_ALT) || former_of_alt) &amp;&amp; (comb_rot_num != 0);
<a name="l00847"></a>00847             
<a name="l00848"></a>00848                 uint64_t _p1 = 0;
<a name="l00849"></a>00849                 <span class="keywordflow">if</span>((_comb_mode != N_COMB_MODE_OFF) &amp;&amp;
<a name="l00850"></a>00850                    !((_comb_mode == N_COMB_MODE_COMB_ALT) &amp;&amp; former_of_alt &amp;&amp; !(comb_rot_num != 0)))
<a name="l00851"></a>00851                 {
<a name="l00852"></a>00852                         _p1 = ((former_of_alt || (_comb_mode != N_COMB_MODE_P1_ALT)) ? _comb_p1 : _comb_p1_alt);
<a name="l00853"></a>00853                 }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855                 uint64_t rest;
<a name="l00856"></a>00856                 <span class="keywordflow">if</span>(_rt_mode == N_RT_MODE_FIXREST)
<a name="l00857"></a>00857                         rest = _rtime;
<a name="l00858"></a>00858                 <span class="keywordflow">else</span>
<a name="l00859"></a>00859                         rest = _rtime - _p1;
<a name="l00860"></a>00860     
<a name="l00861"></a>00861                 <span class="keywordflow">if</span>(saturation_wo_comb &amp;&amp; (_p1 &gt; 0)) rest = 0;
<a name="l00862"></a>00862       
<a name="l00863"></a>00863                 <span class="keywordflow">if</span>(rest &gt; 0) pos += rest;
<a name="l00864"></a>00864       
<a name="l00865"></a>00865                 <span class="comment">//comb pulses</span>
<a name="l00866"></a>00866                 <span class="keywordflow">if</span>((_p1 &gt; 0) &amp;&amp; !saturation_wo_comb)
<a name="l00867"></a>00867                 {
<a name="l00868"></a>00868                         uint64_t combpt = std::max(_comb_pt, _comb_pw + _g2_setup);
<a name="l00869"></a>00869                         uint64_t cpos = pos - combpt*_comb_num;
<a name="l00870"></a>00870      
<a name="l00871"></a>00871                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(cpos - _comb_pw/2 - _g2_setup, comb_off_res ? ~(uint32_t)0 : 0, combfmmask));
<a name="l00872"></a>00872                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(cpos - _comb_pw/2 - _g2_setup, ~(uint32_t)0, combmask));
<a name="l00873"></a>00873                         <span class="keywordtype">bool</span> _g2_each = (_g2_setup * 2 + _comb_pw) &lt; combpt;
<a name="l00874"></a>00874                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k = 0; k &lt; _comb_num; k++)
<a name="l00875"></a>00875                         {
<a name="l00876"></a>00876                                 <span class="keyword">const</span> uint32_t *comb = (_conserve_ste_phase) ?
<a name="l00877"></a>00877                                          ((k % 2 == 0) ? ste_p1 : ste_p2) : comb_ste_cancel;
<a name="l00878"></a>00878                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos + _comb_pw/2, qpsk[comb[j]], qpskmask));
<a name="l00879"></a>00879                                 cpos += combpt;
<a name="l00880"></a>00880                                 cpos -= _comb_pw/2;
<a name="l00881"></a>00881                                 <span class="keywordflow">if</span>(_g2_each || (k == 0))
<a name="l00882"></a>00882                                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(cpos - _g2_setup, g2mask, g2mask));
<a name="l00883"></a>00883                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos, ~(uint32_t)0, g1mask));
<a name="l00884"></a>00884                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos, PAT_QAM_PULSE_IDX_PCOMB, PAT_QAM_PULSE_IDX_MASK));
<a name="l00885"></a>00885                                 cpos += _comb_pw;      
<a name="l00886"></a>00886                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos, 0 , g1mask));
<a name="l00887"></a>00887                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos, 0, PAT_QAM_PULSE_IDX_MASK));
<a name="l00888"></a>00888                                 <span class="keywordflow">if</span>(_g2_each || (k == _comb_num - 1))
<a name="l00889"></a>00889                                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos, 0, g2mask));
<a name="l00890"></a>00890                                 <span class="keywordflow">if</span>(! _qsw_pi_only) {
<a name="l00891"></a>00891                                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos + _qsw_delay, ~(uint32_t)0 , qswmask));
<a name="l00892"></a>00892                                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos + (_qsw_delay + _qsw_width/2 - _qsw_softswoff/2), 0 , qswmask));
<a name="l00893"></a>00893                                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos + (_qsw_delay + _qsw_width/2 + _qsw_softswoff/2), ~(uint32_t)0 , qswmask));
<a name="l00894"></a>00894                                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos + (_qsw_delay + _qsw_width), 0 , qswmask));
<a name="l00895"></a>00895                                 }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897                                 cpos -= _comb_pw/2;
<a name="l00898"></a>00898                         }
<a name="l00899"></a>00899                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos + _comb_pw/2, 0, combmask));
<a name="l00900"></a>00900                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(cpos + _comb_pw/2, ~(uint32_t)0, combfmmask));
<a name="l00901"></a>00901                 }   
<a name="l00902"></a>00902                 pos += _p1;
<a name="l00903"></a>00903        
<a name="l00904"></a>00904                 <span class="comment">//pi/2 pulse</span>
<a name="l00905"></a>00905                 <span class="keywordtype">bool</span> _g2_kept_p1p2 = <span class="keyword">false</span>;
<a name="l00906"></a>00906                 <span class="keywordflow">if</span>(_pw1/2) {
<a name="l00907"></a>00907                         <span class="comment">//on</span>
<a name="l00908"></a>00908                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2 - _g2_setup, qpsk[p1[j]], qpskmask));
<a name="l00909"></a>00909                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2 - _g2_setup, ~(uint32_t)0, g2mask));
<a name="l00910"></a>00910                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2, ~(uint32_t)0, trig2mask));
<a name="l00911"></a>00911                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2 - _g2_setup, ~(uint32_t)0, pulse1mask));
<a name="l00912"></a>00912                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2, PAT_QAM_PULSE_IDX_P1, PAT_QAM_PULSE_IDX_MASK));
<a name="l00913"></a>00913                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2, ~(uint32_t)0, g1mask));
<a name="l00914"></a>00914                         <span class="comment">//off</span>
<a name="l00915"></a>00915                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, g1mask));
<a name="l00916"></a>00916                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, PAT_QAM_PULSE_IDX_MASK));
<a name="l00917"></a>00917                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, pulse1mask));
<a name="l00918"></a>00918                         <span class="keywordflow">if</span>(!_pw2/2 || (_g2_setup * 2 + _pw1/2 + _pw2/2 &lt; _tau)) {
<a name="l00919"></a>00919                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, g2mask));
<a name="l00920"></a>00920                         }
<a name="l00921"></a>00921                         <span class="keywordflow">else</span> {
<a name="l00922"></a>00922                                 _g2_kept_p1p2 = <span class="keyword">true</span>;
<a name="l00923"></a>00923                         }
<a name="l00924"></a>00924                         <span class="keywordflow">if</span>(! _qsw_pi_only) {
<a name="l00925"></a>00925                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + _qsw_delay, ~(uint32_t)0 , qswmask));
<a name="l00926"></a>00926                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + (_qsw_delay + _qsw_width/2 - _qsw_softswoff/2), 0 , qswmask));
<a name="l00927"></a>00927                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + (_qsw_delay + _qsw_width/2 + _qsw_softswoff/2), ~(uint32_t)0 , qswmask));
<a name="l00928"></a>00928                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + (_qsw_delay + _qsw_width), 0 , qswmask));
<a name="l00929"></a>00929                         }
<a name="l00930"></a>00930                 }
<a name="l00931"></a>00931                 <span class="comment">//for pi pulses</span>
<a name="l00932"></a>00932                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, qpsk[p2[j]], qpskmask));
<a name="l00933"></a>00933                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, ~(uint32_t)0, pulse2mask));
<a name="l00934"></a>00934      
<a name="l00935"></a>00935                 <span class="comment">//2tau</span>
<a name="l00936"></a>00936                 pos += 2*_tau;
<a name="l00937"></a>00937                 <span class="comment">//    patterns.insert(tpat(pos - _asw_setup, -1, aswmask | rfswmask, 0));</span>
<a name="l00938"></a>00938                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _asw_setup, ~(uint32_t)0, aswmask));
<a name="l00939"></a>00939                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos -
<a name="l00940"></a>00940                                                          ((!former_of_alt &amp;&amp; comb_mode_alt) ? _alt_sep : 0), ~(uint32_t)0, trig1mask));
<a name="l00941"></a>00941                 
<a name="l00942"></a>00942                 <span class="comment">//induce emission</span>
<a name="l00943"></a>00943                 <span class="keywordflow">if</span>(_induce_emission) {
<a name="l00944"></a>00944                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _induce_emission_pw/2, ~(uint32_t)0, g3mask));
<a name="l00945"></a>00945                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _induce_emission_pw/2, PAT_QAM_PULSE_IDX_INDUCE_EMISSION, PAT_QAM_PULSE_IDX_MASK));
<a name="l00946"></a>00946                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _induce_emission_pw/2, qpsk[pindem[j]], qpskmask));
<a name="l00947"></a>00947                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _induce_emission_pw/2, 0, PAT_QAM_PULSE_IDX_MASK));
<a name="l00948"></a>00948                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _induce_emission_pw/2, 0, g3mask));
<a name="l00949"></a>00949                 }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951                 <span class="comment">//pi pulses </span>
<a name="l00952"></a>00952                 pos -= 3*_tau;
<a name="l00953"></a>00953                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k = 0;k &lt; echonum; k++)
<a name="l00954"></a>00954                 {
<a name="l00955"></a>00955                         pos += 2*_tau;
<a name="l00956"></a>00956                         <span class="keywordflow">if</span>(_pw2/2) {
<a name="l00957"></a>00957                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2, 0, trig2mask));
<a name="l00958"></a>00958                                 <span class="comment">//on</span>
<a name="l00959"></a>00959                                 <span class="keywordflow">if</span>(!_g2_kept_p1p2) {
<a name="l00960"></a>00960                                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2 - _g2_setup, qpsk[p2[j]], qpskmask));
<a name="l00961"></a>00961                                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2 - _g2_setup, ~(uint32_t)0, g2mask));
<a name="l00962"></a>00962                                 }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2, PAT_QAM_PULSE_IDX_P2, PAT_QAM_PULSE_IDX_MASK));
<a name="l00965"></a>00965                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2, ~(uint32_t)0, g1mask));
<a name="l00966"></a>00966                                 <span class="comment">//off</span>
<a name="l00967"></a>00967                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2, 0, PAT_QAM_PULSE_IDX_MASK));
<a name="l00968"></a>00968                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2, 0, g1mask));
<a name="l00969"></a>00969                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2, 0, pulse2mask));
<a name="l00970"></a>00970                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2, 0, g2mask));
<a name="l00971"></a>00971                                 _g2_kept_p1p2 = <span class="keyword">false</span>;
<a name="l00972"></a>00972                                 <span class="comment">//QSW</span>
<a name="l00973"></a>00973                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + _qsw_delay, ~(uint32_t)0 , qswmask));
<a name="l00974"></a>00974                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + (_qsw_delay + _qsw_width/2 - _qsw_softswoff/2), 0 , qswmask));
<a name="l00975"></a>00975                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + (_qsw_delay + _qsw_width/2 + _qsw_softswoff/2), ~(uint32_t)0 , qswmask));
<a name="l00976"></a>00976                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + (_qsw_delay + _qsw_width), 0 , qswmask));
<a name="l00977"></a>00977                         }
<a name="l00978"></a>00978                 }
<a name="l00979"></a>00979                 <span class="keywordflow">if</span>(_g2_kept_p1p2)
<a name="l00980"></a>00980                         <span class="keywordflow">throw</span> <a class="code" href="struct_x_driver_1_1_x_record_error.html">XDriver::XRecordError</a>(<span class="stringliteral">"Inconsistent pattern of pulser setup."</span>, __FILE__, __LINE__);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _tau + _asw_hold, 0, aswmask | trig1mask));
<a name="l00983"></a>00983                 <span class="comment">//induce emission</span>
<a name="l00984"></a>00984                 <span class="keywordflow">if</span>(_induce_emission) {
<a name="l00985"></a>00985                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _tau + _asw_hold - _induce_emission_pw/2, ~(uint32_t)0, g3mask));
<a name="l00986"></a>00986                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _tau + _asw_hold - _induce_emission_pw/2, PAT_QAM_PULSE_IDX_INDUCE_EMISSION, PAT_QAM_PULSE_IDX_MASK));
<a name="l00987"></a>00987                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _tau + _asw_hold - _induce_emission_pw/2, qpsk[pindem[j]], qpskmask));
<a name="l00988"></a>00988                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _tau + _asw_hold + _induce_emission_pw/2, 0, PAT_QAM_PULSE_IDX_MASK));
<a name="l00989"></a>00989                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _tau + _asw_hold + _induce_emission_pw/2, 0, g3mask));
<a name="l00990"></a>00990                 }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992                 <span class="keywordflow">if</span>(driven_equilibrium)
<a name="l00993"></a>00993                 {
<a name="l00994"></a>00994                         pos += 2*_tau;
<a name="l00995"></a>00995                         <span class="comment">//pi pulse </span>
<a name="l00996"></a>00996                         <span class="comment">//on</span>
<a name="l00997"></a>00997                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2 - _g2_setup, qpsk_driven_equilibrium(p2[j]), qpskmask));
<a name="l00998"></a>00998                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2 - _g2_setup, ~(uint32_t)0, g2mask));
<a name="l00999"></a>00999                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2 - _g2_setup, ~(uint32_t)0, pulse2mask));
<a name="l01000"></a>01000                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2, PAT_QAM_PULSE_IDX_P2, PAT_QAM_PULSE_IDX_MASK));
<a name="l01001"></a>01001                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw2/2, ~(uint32_t)0, g1mask));
<a name="l01002"></a>01002                         <span class="comment">//off</span>
<a name="l01003"></a>01003                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2, 0, pulse2mask));
<a name="l01004"></a>01004                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2, 0, PAT_QAM_PULSE_IDX_MASK));
<a name="l01005"></a>01005                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2, 0, g1mask | g2mask));
<a name="l01006"></a>01006                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + _qsw_delay, ~(uint32_t)0 , qswmask));
<a name="l01007"></a>01007                         <span class="keywordflow">if</span>(_qsw_softswoff) {
<a name="l01008"></a>01008                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + (_qsw_delay + _qsw_width/2 - _qsw_softswoff/2), 0 , qswmask));
<a name="l01009"></a>01009                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + (_qsw_delay + _qsw_width/2 + _qsw_softswoff/2), ~(uint32_t)0 , qswmask));
<a name="l01010"></a>01010                         }
<a name="l01011"></a>01011                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw2/2 + (_qsw_delay + _qsw_width), 0 , qswmask));
<a name="l01012"></a>01012                         pos += _tau;
<a name="l01013"></a>01013                         <span class="comment">//pi/2 pulse</span>
<a name="l01014"></a>01014                         <span class="comment">//on</span>
<a name="l01015"></a>01015                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2 - _g2_setup, qpskinv[p1[j]], qpskmask));
<a name="l01016"></a>01016                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2 - _g2_setup, ~(uint32_t)0, pulse1mask));
<a name="l01017"></a>01017                         patterns_cheap.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2 - _g2_setup, ~(uint32_t)0, g2mask));
<a name="l01018"></a>01018                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2, PAT_QAM_PULSE_IDX_P1, PAT_QAM_PULSE_IDX_MASK));
<a name="l01019"></a>01019                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos - _pw1/2, ~(uint32_t)0, g1mask));
<a name="l01020"></a>01020                         <span class="comment">//off</span>
<a name="l01021"></a>01021                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, PAT_QAM_PULSE_IDX_MASK));
<a name="l01022"></a>01022                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, g1mask));
<a name="l01023"></a>01023                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, pulse1mask));
<a name="l01024"></a>01024                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, qpsk[p1[j]], qpskmask));
<a name="l01025"></a>01025                         patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2, 0, g2mask));
<a name="l01026"></a>01026                         <span class="keywordflow">if</span>(! _qsw_pi_only) {
<a name="l01027"></a>01027                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + _qsw_delay, ~(uint32_t)0 , qswmask));
<a name="l01028"></a>01028                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + (_qsw_delay + _qsw_width/2 - _qsw_softswoff/2), 0 , qswmask));
<a name="l01029"></a>01029                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + (_qsw_delay + _qsw_width/2 + _qsw_softswoff/2), ~(uint32_t)0 , qswmask));
<a name="l01030"></a>01030                                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(pos + _pw1/2 + (_qsw_delay + _qsw_width), 0 , qswmask));
<a name="l01031"></a>01031                         }
<a name="l01032"></a>01032                 }
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034     
<a name="l01035"></a>01035         <span class="comment">//insert low priority (cheap) pulses into pattern set</span>
<a name="l01036"></a>01036         <span class="keywordflow">for</span>(tpatset_it it = patterns_cheap.begin(); it != patterns_cheap.end(); it++)
<a name="l01037"></a>01037         {
<a name="l01038"></a>01038                 uint64_t npos = it-&gt;pos;
<a name="l01039"></a>01039                 <span class="keywordflow">for</span>(tpatset_it kit = patterns.begin(); kit != patterns.end(); kit++)
<a name="l01040"></a>01040                 {
<a name="l01041"></a>01041                         <span class="comment">//Avoid overrapping within 1 us</span>
<a name="l01042"></a>01042                         uint64_t diff = llabs(kit-&gt;pos - npos);
<a name="l01043"></a>01043                         diff -= pos * (diff / pos);
<a name="l01044"></a>01044                         <span class="keywordflow">if</span>(diff &lt; rintSampsMilliSec(minPulseWidth()))
<a name="l01045"></a>01045                         {
<a name="l01046"></a>01046                                 npos = kit-&gt;pos;
<a name="l01047"></a>01047                                 <span class="keywordflow">break</span>;
<a name="l01048"></a>01048                         }
<a name="l01049"></a>01049                 }
<a name="l01050"></a>01050                 patterns.insert(<a class="code" href="classtpat.html">tpat</a>(npos, it-&gt;pat, it-&gt;mask));
<a name="l01051"></a>01051         }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053         <span class="comment">//determine the first pattern and the length.</span>
<a name="l01054"></a>01054         uint64_t lastpos = 0;
<a name="l01055"></a>01055         uint32_t pat = 0;
<a name="l01056"></a>01056         <span class="keywordflow">for</span>(tpatset_it it = patterns.begin(); it != patterns.end(); it++) {
<a name="l01057"></a>01057                 lastpos = it-&gt;pos - pos;
<a name="l01058"></a>01058                 pat &amp;= ~it-&gt;mask;
<a name="l01059"></a>01059                 pat |= (it-&gt;pat &amp; it-&gt;mask);
<a name="l01060"></a>01060         }
<a name="l01061"></a>01061         uint64_t patpos = patterns.begin()-&gt;pos;
<a name="l01062"></a>01062         <span class="keywordflow">for</span>(tpatset_it it = patterns.begin(); it != patterns.end();) {
<a name="l01063"></a>01063                 pat &amp;= ~it-&gt;mask;
<a name="l01064"></a>01064                 pat |= (it-&gt;pat &amp; it-&gt;mask);
<a name="l01065"></a>01065                 it++;
<a name="l01066"></a>01066                 <span class="keywordflow">if</span>((it == patterns.end()) || (it-&gt;pos != patpos)) {
<a name="l01067"></a>01067                         <span class="comment">//skip duplicated patterns.</span>
<a name="l01068"></a>01068                         <span class="keywordflow">if</span>((it != patterns.end()) &amp;&amp;
<a name="l01069"></a>01069                                         m_relPatList.size() &amp;&amp;
<a name="l01070"></a>01070                                         (pat == m_relPatList[m_relPatList.size() - 1].pattern)) {
<a name="l01071"></a>01071                                 patpos = it-&gt;pos;
<a name="l01072"></a>01072                                 <span class="keywordflow">continue</span>;
<a name="l01073"></a>01073                         }
<a name="l01074"></a>01074                         RelPat relpat(pat, patpos, patpos - lastpos);
<a name="l01075"></a>01075                         m_relPatList.push_back(relpat);
<a name="l01076"></a>01076                         <span class="keywordflow">if</span>(it == patterns.end()) <span class="keywordflow">break</span>;
<a name="l01077"></a>01077                         lastpos = patpos;
<a name="l01078"></a>01078                         patpos = it-&gt;pos;
<a name="l01079"></a>01079                 }
<a name="l01080"></a>01080         }
<a name="l01081"></a>01081     
<a name="l01082"></a>01082     <span class="keywordflow">if</span>(haveQAMPorts()) {
<a name="l01083"></a>01083         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; PAT_QAM_PULSE_IDX_MASK/PAT_QAM_PULSE_IDX; i++)
<a name="l01084"></a>01084                 m_qamWaveForm[i].clear();
<a name="l01085"></a>01085                 
<a name="l01086"></a>01086                 <span class="keywordtype">double</span> _tau = m_tauRecorded;
<a name="l01087"></a>01087                 <span class="keywordtype">double</span> _dif_freq = m_difFreqRecorded;
<a name="l01088"></a>01088         
<a name="l01089"></a>01089                 <span class="keywordtype">bool</span> _induce_emission = *induceEmission();
<a name="l01090"></a>01090                 <span class="keywordtype">double</span> _induce_emission_phase = *induceEmissionPhase() / 180.0 * M_PI;
<a name="l01091"></a>01091 
<a name="l01092"></a>01092                 makeWaveForm(PAT_QAM_PULSE_IDX_P1/PAT_QAM_PULSE_IDX - 1, m_pw1Recorded*1e-3,
<a name="l01093"></a>01093                                          _pw1/2, pulseFunc(p1Func()-&gt;to_str() ),
<a name="l01094"></a>01094                                          *p1Level(), _dif_freq * 1e3, -2 * M_PI * _dif_freq * 2 * _tau);
<a name="l01095"></a>01095                 makeWaveForm(PAT_QAM_PULSE_IDX_P2/PAT_QAM_PULSE_IDX - 1, m_pw2Recorded*1e-3, 
<a name="l01096"></a>01096                                          _pw2/2, pulseFunc(p2Func()-&gt;to_str() ),
<a name="l01097"></a>01097                                          *p2Level(), _dif_freq * 1e3, -2 * M_PI * _dif_freq * 2 * _tau);
<a name="l01098"></a>01098                 makeWaveForm(PAT_QAM_PULSE_IDX_PCOMB/PAT_QAM_PULSE_IDX - 1, m_combPWRecorded*1e-3,
<a name="l01099"></a>01099                                          _comb_pw/2, pulseFunc(combFunc()-&gt;to_str() ),
<a name="l01100"></a>01100                                          *combLevel(), *combOffRes() + _dif_freq *1000.0);
<a name="l01101"></a>01101                 <span class="keywordflow">if</span>(_induce_emission) {
<a name="l01102"></a>01102                         makeWaveForm(PAT_QAM_PULSE_IDX_INDUCE_EMISSION/PAT_QAM_PULSE_IDX - 1, m_combPWRecorded*1e-3,
<a name="l01103"></a>01103                                                  _induce_emission_pw/2, pulseFunc(combFunc()-&gt;to_str() ),
<a name="l01104"></a>01104                                                  *combLevel(), *combOffRes() + _dif_freq *1000.0, _induce_emission_phase);
<a name="l01105"></a>01105                 }
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 
<a name="l01109"></a>01109 <span class="keywordtype">void</span>
<a name="l01110"></a><a class="code" href="class_x_pulser.html#6624c1da4ec56de0975711194dbe6d9f">01110</a> <a class="code" href="class_x_pulser.html#6624c1da4ec56de0975711194dbe6d9f">XPulser::makeWaveForm</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pnum_minus_1, 
<a name="l01111"></a>01111                                           <span class="keywordtype">double</span> pw, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> to_center,
<a name="l01112"></a>01112                                           tpulsefunc func, <span class="keywordtype">double</span> dB, <span class="keywordtype">double</span> freq, <span class="keywordtype">double</span> phase)
<a name="l01113"></a>01113 {
<a name="l01114"></a>01114         std::vector&lt;std::complex&lt;double&gt; &gt; &amp;p = <a class="code" href="class_x_pulser.html#994a710578b5762ca3bc32954f8dc3af">m_qamWaveForm</a>[pnum_minus_1];
<a name="l01115"></a>01115         <span class="keywordtype">double</span> dma_ao_period = resolutionQAM();
<a name="l01116"></a>01116         to_center *= lrint(<a class="code" href="class_x_pulser.html#6e9f9aba09706ad54f6d46c633144d79">resolution</a>() / dma_ao_period);
<a name="l01117"></a>01117         <span class="keywordtype">double</span> delay1 = *<a class="code" href="class_x_pulser.html#58eff26409df38012b819dd90302cb95">qamDelay1</a>() * 1e-3 / dma_ao_period;
<a name="l01118"></a>01118         <span class="keywordtype">double</span> delay2 = *<a class="code" href="class_x_pulser.html#c0beb6172f725e3c8b9500a6681771cb">qamDelay2</a>() * 1e-3 / dma_ao_period;
<a name="l01119"></a>01119         <span class="keywordtype">double</span> dx = dma_ao_period / pw;
<a name="l01120"></a>01120         <span class="keywordtype">double</span> dp = 2*M_PI*freq*dma_ao_period;
<a name="l01121"></a>01121         <span class="keywordtype">double</span> z = pow(10.0, dB/20.0);
<a name="l01122"></a>01122         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; (int)to_center*2; i++) {
<a name="l01123"></a>01123                 <span class="keywordtype">double</span> i1 = i - (<span class="keywordtype">int</span>)to_center + 0.5 - delay1;
<a name="l01124"></a>01124                 <span class="keywordtype">double</span> i2 = i - (int)to_center + 0.5 - delay2;
<a name="l01125"></a>01125                 <span class="keywordtype">double</span> x = z * func(i1 * dx) * cos(i1 * dp + M_PI/4 + phase);
<a name="l01126"></a>01126                 <span class="keywordtype">double</span> y = z * func(i2 * dx) * sin(i2 * dp + M_PI/4 + phase);
<a name="l01127"></a>01127                 p.push_back(std::complex&lt;double&gt;(x, y));
<a name="l01128"></a>01128         }
<a name="l01129"></a>01129 }
</pre></div><hr size="1"><address style="align: right;"><small>KAME2に対してFri Jan 25 00:34:30 2008に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
