<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KAME2: modules/nidaq/nidaqmxdriver.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="../../dir_c17a6312adb6ef1af4037d741e35ac41.html">modules</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_246c4d0f71b3aab7c3bc8f2ceccc4f2e.html">nidaq</a></div>
<h1>nidaqmxdriver.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">        Copyright (C) 2002-2008 Kentaro Kitagawa</span>
<a name="l00003"></a>00003 <span class="comment">                           kitag@issp.u-tokyo.ac.jp</span>
<a name="l00004"></a>00004 <span class="comment">        </span>
<a name="l00005"></a>00005 <span class="comment">        This program is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment">        modify it under the terms of the GNU Library General Public</span>
<a name="l00007"></a>00007 <span class="comment">        License as published by the Free Software Foundation; either</span>
<a name="l00008"></a>00008 <span class="comment">        version 2 of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">        </span>
<a name="l00010"></a>00010 <span class="comment">        You should have received a copy of the GNU Library General </span>
<a name="l00011"></a>00011 <span class="comment">        Public License and a list of authors along with this program; </span>
<a name="l00012"></a>00012 <span class="comment">        see the files COPYING and AUTHORS.</span>
<a name="l00013"></a>00013 <span class="comment">***************************************************************************/</span>
<a name="l00014"></a>00014 <span class="preprocessor">#ifndef NIDAQMXDRIVER_H_</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#define NIDAQMXDRIVER_H_</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#endif </span><span class="comment">/*HAVE_CONFIG_H*/</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include "interface.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "driver.h"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "atomic_queue.h"</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#ifdef HAVE_NI_DAQMX</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">    #include &lt;NIDAQmx.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">    #define CHECK_DAQMX_ERROR(ret) XNIDAQmxInterface::checkDAQmxError(ret, __FILE__, __LINE__)</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>    
<a name="l00029"></a>00029     <span class="comment">/*#define CHECK_DAQMX_RET(ret, msg) {dbgPrint(# ret);\</span>
<a name="l00030"></a>00030 <span class="comment">      if(CHECK_DAQMX_ERROR(ret, msg) &gt; 0) {gWarnPrint(QString(msg) + " " + XNIDAQmxInterface::getNIDAQmxErrMessage()); } }</span>
<a name="l00031"></a>00031 <span class="comment">    */</span>
<a name="l00032"></a>00032 <span class="preprocessor">    #define CHECK_DAQMX_RET(ret) {int _code = ret; \</span>
<a name="l00033"></a>00033 <span class="preprocessor">        if(CHECK_DAQMX_ERROR(_code) &gt; 0) {gWarnPrint(XNIDAQmxInterface::getNIDAQmxErrMessage(_code)); } }</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">    #define CHECK_DAQMX_ERROR(ret) (0)</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">    #define CHECK_DAQMX_RET(ret)</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TaskHandle;
<a name="l00038"></a>00038     <span class="keyword">typedef</span> int64_t int64;
<a name="l00039"></a>00039     <span class="keyword">typedef</span> uint64_t uInt64;
<a name="l00040"></a>00040     <span class="keyword">typedef</span> int32_t int32;
<a name="l00041"></a>00041     <span class="keyword">typedef</span> uint32_t uInt32;
<a name="l00042"></a>00042     <span class="keyword">typedef</span> int16_t int16;
<a name="l00043"></a>00043     <span class="keyword">typedef</span> uint16_t uInt16;
<a name="l00044"></a>00044     <span class="keyword">typedef</span> int8_t int8;
<a name="l00045"></a>00045     <span class="keyword">typedef</span> uint8_t uInt8;
<a name="l00046"></a>00046     <span class="keyword">typedef</span> <span class="keywordtype">double</span> float64;
<a name="l00047"></a>00047 <span class="preprocessor">#endif //HAVE_NI_DAQMX</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="keyword">class </span>XNIDAQmxTask;
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html">00051</a> <span class="keyword">class </span><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html">XNIDAQmxInterface</a> : <span class="keyword">public</span> <a class="code" href="../../db/da8/class_x_interface.html">XInterface</a>
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053     XNODE_OBJECT
<a name="l00054"></a>00054 <span class="keyword">protected</span>:
<a name="l00055"></a>00055     <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#9830a981b62237fb165c1327a3d8beff">XNIDAQmxInterface</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">bool</span> runtime, <span class="keyword">const</span> shared_ptr&lt;XDriver&gt; &amp;<a class="code" href="../../db/da8/class_x_interface.html#eb80df29ee2054836afcee7a59ea516f">driver</a>);
<a name="l00056"></a>00056 <span class="keyword">public</span>:
<a name="l00057"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#18b3be5d740dbc3bb6677e0e81a02206">00057</a>     <span class="keyword">virtual</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#18b3be5d740dbc3bb6677e0e81a02206">~XNIDAQmxInterface</a>() {}
<a name="l00058"></a>00058  
<a name="l00059"></a>00059     <span class="keyword">static</span> QString <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#086bf7c8d92db73583c9a66bd2d69903">getNIDAQmxErrMessage</a>();
<a name="l00060"></a>00060     <span class="keyword">static</span> QString <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#086bf7c8d92db73583c9a66bd2d69903">getNIDAQmxErrMessage</a>(<span class="keywordtype">int</span> status);
<a name="l00061"></a>00061     <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#85378e6b8bc48ba167be588448426a2e">checkDAQmxError</a>(<span class="keywordtype">int</span> ret, <span class="keyword">const</span> <span class="keywordtype">char</span>*file, <span class="keywordtype">int</span> line);
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#2c4d149f7e8bf5c7493e889642792d11">00063</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#2c4d149f7e8bf5c7493e889642792d11">isOpened</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#bac3884d88cddb45c9004408fe9638c6">m_devname</a>.length();}
<a name="l00064"></a>00064   <span class="comment"></span>
<a name="l00065"></a>00065 <span class="comment">    //! e.g. "Dev1".</span>
<a name="l00066"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#e32f83e624d87113efd5aa727b84ff1a">00066</a> <span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>*<a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#e32f83e624d87113efd5aa727b84ff1a">devName</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#bac3884d88cddb45c9004408fe9638c6">m_devname</a>.c_str();}<span class="comment"></span>
<a name="l00067"></a>00067 <span class="comment">    //! Split camma-separated strings.</span>
<a name="l00068"></a>00068 <span class="comment"></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#585763930c3facb8d8e27f3e1f40c840">parseList</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *list, std::deque&lt;std::string&gt; &amp;buf);
<a name="l00069"></a>00069   <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">    //! Each task must call this to tell the reference frequency.</span>
<a name="l00071"></a>00071 <span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#cc86c0e65581d05feadc25c6b4dd2c13">synchronizeClock</a>(TaskHandle task);
<a name="l00072"></a>00072     
<a name="l00073"></a><a class="code" href="../../de/dfc/class_x_n_i_d_a_qmx_interface_1_1_x_n_i_d_a_qmx_route.html">00073</a>     <span class="keyword">class </span><a class="code" href="../../de/dfc/class_x_n_i_d_a_qmx_interface_1_1_x_n_i_d_a_qmx_route.html">XNIDAQmxRoute</a> {
<a name="l00074"></a>00074     <span class="keyword">public</span>:
<a name="l00075"></a>00075         <a class="code" href="../../de/dfc/class_x_n_i_d_a_qmx_interface_1_1_x_n_i_d_a_qmx_route.html#e2012e0027a5f06b30ef5ea9330ac605">XNIDAQmxRoute</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>*src, <span class="keyword">const</span> <span class="keywordtype">char</span>*dst, <span class="keywordtype">int</span> *ret = NULL);
<a name="l00076"></a>00076         <a class="code" href="../../de/dfc/class_x_n_i_d_a_qmx_interface_1_1_x_n_i_d_a_qmx_route.html#0ec2a0ba361053031951de086e73b4dc">~XNIDAQmxRoute</a>();
<a name="l00077"></a>00077     <span class="keyword">private</span>:
<a name="l00078"></a><a class="code" href="../../de/dfc/class_x_n_i_d_a_qmx_interface_1_1_x_n_i_d_a_qmx_route.html#f78199ec4df68c1242c4a40e279a0c9d">00078</a>         std::string <a class="code" href="../../de/dfc/class_x_n_i_d_a_qmx_interface_1_1_x_n_i_d_a_qmx_route.html#f78199ec4df68c1242c4a40e279a0c9d">m_src</a>, <a class="code" href="../../de/dfc/class_x_n_i_d_a_qmx_interface_1_1_x_n_i_d_a_qmx_route.html#dfdb1021c86e8baaa0da568523d1773d">m_dst</a>;
<a name="l00079"></a>00079     };
<a name="l00080"></a>00080     <span class="comment"></span>
<a name="l00081"></a>00081 <span class="comment">    //! e.g. "PCI-6111".</span>
<a name="l00082"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#7a4cdd5939400ecdc2c90e52884cdb35">00082</a> <span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#7a4cdd5939400ecdc2c90e52884cdb35">productType</a>()<span class="keyword"> const </span>{
<a name="l00083"></a>00083         <span class="keyword">const</span> <a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html">ProductInfo</a>* p = <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>;
<a name="l00084"></a>00084         <span class="keywordflow">return</span> p ? p-&gt;<a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#1c93763ca1181deac9b4d8a8fc9f2558">type</a> : 0L;
<a name="l00085"></a>00085     }<span class="comment"></span>
<a name="l00086"></a>00086 <span class="comment">    //! e.g. "S", "M".</span>
<a name="l00087"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#0de167a06ff4f0099f4a153e14b2c583">00087</a> <span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#0de167a06ff4f0099f4a153e14b2c583">productSeries</a>()<span class="keyword"> const </span>{
<a name="l00088"></a>00088         <span class="keyword">const</span> <a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html">ProductInfo</a>* p = <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>;
<a name="l00089"></a>00089         <span class="keywordflow">return</span> p ? p-&gt;<a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#db5551ee268df468b6d8eae89536ad36">series</a> : 0L;
<a name="l00090"></a>00090     }<span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">    //! e.g. "PCI", "PXI". Never "PCIe" or "PXIe".</span>
<a name="l00092"></a>00092 <span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#564ab77a13f437bd026a832f98d1d46c">busArchType</a>() <span class="keyword">const</span>;
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#3c003260b07f981a88023fa0177f4768">00094</a>     <span class="keyword">enum</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#3c003260b07f981a88023fa0177f4768">FLAGS</a> {
<a name="l00095"></a>00095         FLAG_BUGGY_DMA_AO = 0x10u, FLAG_BUGGY_DMA_AI = 0x20u, 
<a name="l00096"></a>00096         FLAG_BUGGY_DMA_DI = 0x40u, FLAG_BUGGY_DMA_DO = 0x80u,
<a name="l00097"></a>00097         FLAG_BUGGY_XFER_COND_AO = 0x100u, FLAG_BUGGY_XFER_COND_AI = 0x200u,
<a name="l00098"></a>00098         FLAG_BUGGY_XFER_COND_DI = 0x400u, FLAG_BUGGY_XFER_COND_DO = 0x800u};<span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">    //! e.g. FLAG_BUGGY_DMA_AO.</span>
<a name="l00100"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#1b98b4446062302a2818b38f09688ea8">00100</a> <span class="comment"></span>    <span class="keywordtype">int</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#1b98b4446062302a2818b38f09688ea8">productFlags</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>-&gt;<a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#b0fb2e014a5ddd9a6fa3d909a179a853">flags</a>;}<span class="comment"></span>
<a name="l00101"></a>00101 <span class="comment">    //! \return 0 if hw timed transfer is not supported.</span>
<a name="l00102"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#f5c7515631252aaab348e06a2de1109c">00102</a> <span class="comment"></span>    <span class="keywordtype">double</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#f5c7515631252aaab348e06a2de1109c">maxAIRate</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*num_scans*/</span>)<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>-&gt;<a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#f88e6b9917ff47346b0ac47cadc90acb">ai_max_rate</a>;}
<a name="l00103"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#e6ebee121365f6a793924f5ba58fde10">00103</a>     <span class="keywordtype">double</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#e6ebee121365f6a793924f5ba58fde10">maxAORate</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*num_scans*/</span>)<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>-&gt;<a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#a1d533203e9428f38813f5135758ab3e">ao_max_rate</a>;}
<a name="l00104"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#07be5a2d19ff30bdb88109e4e0b79265">00104</a>     <span class="keywordtype">double</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#07be5a2d19ff30bdb88109e4e0b79265">maxDIRate</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*num_scans*/</span>)<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>-&gt;<a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#e4a1645e37713a2a2cdaba7cff544668">di_max_rate</a>;}
<a name="l00105"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#50c5a9307c684304b653107bb41ec891">00105</a>     <span class="keywordtype">double</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#50c5a9307c684304b653107bb41ec891">maxDORate</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="comment">/*num_scans*/</span>)<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>-&gt;<a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#2cc824d8fe8a0c756f400462f638d282">do_max_rate</a>;}
<a name="l00106"></a>00106       
<a name="l00107"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html">00107</a>     <span class="keyword">class </span><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html">SoftwareTrigger</a> : <span class="keyword">public</span> enable_shared_from_this&lt;SoftwareTrigger&gt; {
<a name="l00108"></a>00108     <span class="keyword">protected</span>:
<a name="l00109"></a>00109         <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#ebd178c891687657118ea05a9e6eee17">SoftwareTrigger</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#91c3b25bf4443450606db6ee45cf6469">label</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#18016f29b3e3f17444ca583d7504b46c">bits</a>);
<a name="l00110"></a>00110     <span class="keyword">public</span>:
<a name="l00111"></a>00111         <span class="keyword">static</span> shared_ptr&lt;SoftwareTrigger&gt; <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#7bf6a80994b089138833863f043cacb4">create</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *label, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bits);
<a name="l00112"></a>00112         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#aa373a28caf9d7065ccb992c03b12ffe">unregister</a>(<span class="keyword">const</span> shared_ptr&lt;SoftwareTrigger&gt; &amp;);
<a name="l00113"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#91c3b25bf4443450606db6ee45cf6469">00113</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#91c3b25bf4443450606db6ee45cf6469">label</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#6619695844818fb6cd10ad6bb2f02079">m_label</a>.c_str();}
<a name="l00114"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#73ed0e8b3eaf3e745e652dae76242a92">00114</a>         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#73ed0e8b3eaf3e745e652dae76242a92">setArmTerm</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *arm_term) {<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#42629e99d5ebece3ebf2177952beb3db">m_armTerm</a> = arm_term;}
<a name="l00115"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4c765450572c64223aed9d1d7767f530">00115</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4c765450572c64223aed9d1d7767f530">armTerm</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#42629e99d5ebece3ebf2177952beb3db">m_armTerm</a>.c_str();}
<a name="l00116"></a>00116             
<a name="l00117"></a>00117         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#207299a348cb95b3d40f4c14533dee34">start</a>(float64 <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#da9f6eaf5bad5b02652bcd0b6aca2fb7">freq</a>);
<a name="l00118"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#da9f6eaf5bad5b02652bcd0b6aca2fb7">00118</a>         float64 <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#da9f6eaf5bad5b02652bcd0b6aca2fb7">freq</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#5458b092f52a17d043d158ceced66bd2">m_freq</a>;} <span class="comment">//!&lt; [Hz].</span>
<a name="l00119"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#18016f29b3e3f17444ca583d7504b46c">00119</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#18016f29b3e3f17444ca583d7504b46c">bits</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#78ccc02068fefff43a2babe88ac85733">m_bits</a>;}
<a name="l00120"></a>00120         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#36eb36789dcb60749d87f3b91122f6a6">stop</a>();
<a name="l00121"></a>00121         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#20e6e8be5e5ef1562ecbe69ee9c39e57">forceStamp</a>(uint64_t now, float64 <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#da9f6eaf5bad5b02652bcd0b6aca2fb7">freq</a>);
<a name="l00122"></a>00122         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#776521e8841e139c36bc540db346d88d">stamp</a>(uint64_t cnt);
<a name="l00123"></a>00123         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00124"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4b6832b78407233ebd4ee1175b9c891d">00124</a>         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4b6832b78407233ebd4ee1175b9c891d">changeValue</a>(T oldval, T val, uint64_t time) {
<a name="l00125"></a>00125             <span class="keywordflow">if</span>(((<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#811590b4e8197cf05aff48e2556af306">m_risingEdgeMask</a> &amp; val) &amp; (<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#811590b4e8197cf05aff48e2556af306">m_risingEdgeMask</a> &amp; ~oldval))
<a name="l00126"></a>00126                || ((<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#ae9eff2b3327367eece2649e22cfa65d">m_fallingEdgeMask</a> &amp; ~val) &amp; (<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#ae9eff2b3327367eece2649e22cfa65d">m_fallingEdgeMask</a> &amp; oldval))) {
<a name="l00127"></a>00127                 <span class="keywordflow">if</span>(time &lt; <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#fc8becb5873c827d548568b301b6c7e4">m_endOfBlank</a>) <span class="keywordflow">return</span>;
<a name="l00128"></a>00128                 <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#776521e8841e139c36bc540db346d88d">stamp</a>(time);
<a name="l00129"></a>00129             }
<a name="l00130"></a>00130         }
<a name="l00131"></a>00131         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#b8cab99d4dcdf79bdc915bd607f37fbb">connect</a>(uint32_t rising_edge_mask, 
<a name="l00132"></a>00132                      uint32_t falling_edge_mask) <span class="keywordflow">throw</span> (<a class="code" href="../../de/d67/struct_x_interface_1_1_x_interface_error.html">XInterface::XInterfaceError</a> &amp;);
<a name="l00133"></a>00133         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#8ec52a71c07cc734d489ee7d7919ee4d">disconnect</a>();<span class="comment"></span>
<a name="l00134"></a>00134 <span class="comment">        //! \arg blankterm in seconds.</span>
<a name="l00135"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#21d68ad840414a11a5f795b886478e60">00135</a> <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#21d68ad840414a11a5f795b886478e60">setBlankTerm</a>(float64 blankterm) {
<a name="l00136"></a>00136             <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4a2526d6d2c9570119cb16eb293257f2">m_blankTerm</a> = lrint(blankterm * <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#da9f6eaf5bad5b02652bcd0b6aca2fb7">freq</a>());
<a name="l00137"></a>00137             memoryBarrier();
<a name="l00138"></a>00138         }<span class="comment"></span>
<a name="l00139"></a>00139 <span class="comment">        //! for restarting connected task.</span>
<a name="l00140"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#51765dda784fea1d5792830180c27357">00140</a> <span class="comment"></span>        <a class="code" href="../../d6/dbd/class_x_talker.html">XTalker&lt;shared_ptr&lt;SoftwareTrigger&gt;</a> &gt; &amp;<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#51765dda784fea1d5792830180c27357">onStart</a>() {<span class="keywordflow">return</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0c2c874fb4b77e5765e3906c20fab3bb">m_onStart</a>;}<span class="comment"></span>
<a name="l00141"></a>00141 <span class="comment">        //! for changeing list.</span>
<a name="l00142"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#c2bd536bd547320298acc0dc1a5e4bc4">00142</a> <span class="comment"></span>        <span class="keyword">static</span> <a class="code" href="../../d6/dbd/class_x_talker.html">XTalker&lt;shared_ptr&lt;SoftwareTrigger&gt;</a> &gt; &amp;<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#c2bd536bd547320298acc0dc1a5e4bc4">onChange</a>() {<span class="keywordflow">return</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#b80d056c5aaaa6dbdd3380646ef3c4d7">s_onChange</a>;}
<a name="l00143"></a>00143             
<a name="l00144"></a>00144         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#009067ee7324fff9dfbd6bb95838286f">clear</a>(uint64_t now, float64 <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#da9f6eaf5bad5b02652bcd0b6aca2fb7">freq</a>);
<a name="l00145"></a>00145         uint64_t <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#9de49f90b33d6fac60bb68fa74b6c055">tryPopFront</a>(uint64_t threshold, float64 <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#da9f6eaf5bad5b02652bcd0b6aca2fb7">freq</a>);
<a name="l00146"></a>00146             
<a name="l00147"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#c345e461ab12ce76e8991d0800a2808c">00147</a>         <span class="keyword">typedef</span> std::deque&lt;shared_ptr&lt;XNIDAQmxInterface::SoftwareTrigger&gt; &gt; <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#c345e461ab12ce76e8991d0800a2808c">SoftwareTriggerList</a>;
<a name="l00148"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4d7b2ef1b8637ef2ad746e61c1b984c6">00148</a>         <span class="keyword">typedef</span> SoftwareTriggerList::iterator <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4d7b2ef1b8637ef2ad746e61c1b984c6">SoftwareTriggerList_it</a>;
<a name="l00149"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#fab6191b60b248c5455b9cb2c47e41d1">00149</a>         <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../da/dad/classatomic__shared__ptr.html">atomic_shared_ptr&lt;SoftwareTriggerList&gt;</a> &amp;<a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#fab6191b60b248c5455b9cb2c47e41d1">virtualTrigList</a>() {
<a name="l00150"></a>00150             <span class="keywordflow">return</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0bfb61c61e4a9ba97ba52adebf4ba321">s_virtualTrigList</a>;
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152     <span class="keyword">private</span>:
<a name="l00153"></a>00153         <span class="keywordtype">void</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#21ab3504998d7fdf22d5d70e691a94b5">_clear</a>();
<a name="l00154"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#6619695844818fb6cd10ad6bb2f02079">00154</a>         <span class="keyword">const</span> std::string <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#6619695844818fb6cd10ad6bb2f02079">m_label</a>;
<a name="l00155"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#42629e99d5ebece3ebf2177952beb3db">00155</a>         std::string <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#42629e99d5ebece3ebf2177952beb3db">m_armTerm</a>;
<a name="l00156"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#78ccc02068fefff43a2babe88ac85733">00156</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#78ccc02068fefff43a2babe88ac85733">m_bits</a>;
<a name="l00157"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#811590b4e8197cf05aff48e2556af306">00157</a>         uint32_t <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#811590b4e8197cf05aff48e2556af306">m_risingEdgeMask</a>, <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#ae9eff2b3327367eece2649e22cfa65d">m_fallingEdgeMask</a>;
<a name="l00158"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#fc8becb5873c827d548568b301b6c7e4">00158</a>         uint64_t <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#4a2526d6d2c9570119cb16eb293257f2">m_blankTerm</a>, <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#fc8becb5873c827d548568b301b6c7e4">m_endOfBlank</a>;
<a name="l00159"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#5458b092f52a17d043d158ceced66bd2">00159</a>         float64 <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#5458b092f52a17d043d158ceced66bd2">m_freq</a>; <span class="comment">//!&lt; [Hz].</span>
<a name="l00160"></a>00160 <span class="comment"></span>        <span class="keyword">enum</span> {QUEUE_SIZE = 8192};
<a name="l00161"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#5e99efb74e7f1ac41a8ebcfa725eb1b8">00161</a>         <span class="keyword">typedef</span> <a class="code" href="../../d4/d7a/classatomic__queue__reserved.html">atomic_queue_reserved&lt;uint64_t, QUEUE_SIZE&gt;</a> <a class="code" href="../../d4/d7a/classatomic__queue__reserved.html">FastQueue</a>;
<a name="l00162"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#183524364893412ae71ccba0fe38b5bc">00162</a>         <a class="code" href="../../d4/d7a/classatomic__queue__reserved.html">FastQueue</a> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#183524364893412ae71ccba0fe38b5bc">m_fastQueue</a>;
<a name="l00163"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0f2ee8e0b6b6fca10b2a580803021075">00163</a>         <span class="keyword">typedef</span> std::deque&lt;uint64_t&gt; <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0f2ee8e0b6b6fca10b2a580803021075">SlowQueue</a>;
<a name="l00164"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#9af186d686dda4a13336fc3f36deadae">00164</a>         <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0f2ee8e0b6b6fca10b2a580803021075">SlowQueue</a> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#9af186d686dda4a13336fc3f36deadae">m_slowQueue</a>;
<a name="l00165"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#c27c6b522badcc00fc086e9a05078354">00165</a>         <a class="code" href="../../dc/db7/classatomic.html">atomic&lt;unsigned int&gt;</a> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#c27c6b522badcc00fc086e9a05078354">m_slowQueueSize</a>;
<a name="l00166"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#ba09095ef3490ae49545e4178d3caf63">00166</a>         <a class="code" href="../../d1/d2b/class_x_pthread_mutex.html">XMutex</a> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#ba09095ef3490ae49545e4178d3caf63">m_mutex</a>;
<a name="l00167"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0c2c874fb4b77e5765e3906c20fab3bb">00167</a>         <a class="code" href="../../d6/dbd/class_x_talker.html">XTalker&lt;shared_ptr&lt;SoftwareTrigger&gt;</a> &gt; <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0c2c874fb4b77e5765e3906c20fab3bb">m_onStart</a>;
<a name="l00168"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#b80d056c5aaaa6dbdd3380646ef3c4d7">00168</a>         <span class="keyword">static</span> <a class="code" href="../../d6/dbd/class_x_talker.html">XTalker&lt;shared_ptr&lt;SoftwareTrigger&gt;</a> &gt; <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#b80d056c5aaaa6dbdd3380646ef3c4d7">s_onChange</a>;
<a name="l00169"></a><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0bfb61c61e4a9ba97ba52adebf4ba321">00169</a>         <span class="keyword">static</span> <a class="code" href="../../da/dad/classatomic__shared__ptr.html">atomic_shared_ptr&lt;SoftwareTriggerList&gt;</a> <a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html#0bfb61c61e4a9ba97ba52adebf4ba321">s_virtualTrigList</a>;
<a name="l00170"></a>00170     };
<a name="l00171"></a>00171 <span class="keyword">protected</span>:
<a name="l00172"></a>00172     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#745b73a0b4d65c587cc2da22214edecc">open</a>() throw (XInterfaceError &amp;);<span class="comment"></span>
<a name="l00173"></a>00173 <span class="comment">    //! This can be called even if has already closed.</span>
<a name="l00174"></a>00174 <span class="comment"></span>    virtual <span class="keywordtype">void</span> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#3d8e94ec57b1ec56cf42d01d2f3d9c2e">close</a>() throw (XInterfaceError &amp;);
<a name="l00175"></a>00175 private:
<a name="l00176"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html">00176</a>     struct <a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html">ProductInfo</a> {
<a name="l00177"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#1c93763ca1181deac9b4d8a8fc9f2558">00177</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> *type;
<a name="l00178"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#db5551ee268df468b6d8eae89536ad36">00178</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> *series;
<a name="l00179"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#b0fb2e014a5ddd9a6fa3d909a179a853">00179</a>         <span class="keywordtype">int</span> flags;
<a name="l00180"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#f88e6b9917ff47346b0ac47cadc90acb">00180</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ai_max_rate; <span class="comment">//!&lt; [kHz]</span>
<a name="l00181"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#a1d533203e9428f38813f5135758ab3e">00181</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ao_max_rate; <span class="comment">//!&lt; [kHz]</span>
<a name="l00182"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#e4a1645e37713a2a2cdaba7cff544668">00182</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> di_max_rate; <span class="comment">//!&lt; [kHz]</span>
<a name="l00183"></a><a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html#2cc824d8fe8a0c756f400462f638d282">00183</a> <span class="comment"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> do_max_rate; <span class="comment">//!&lt; [kHz]</span>
<a name="l00184"></a>00184 <span class="comment"></span>    };
<a name="l00185"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#516394effa644e3e759eed08499307f3">00185</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../dd/d99/class_x_n_i_d_a_qmx_interface_1_1_software_trigger.html">SoftwareTrigger</a>;
<a name="l00186"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#bac3884d88cddb45c9004408fe9638c6">00186</a>     std::string <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#bac3884d88cddb45c9004408fe9638c6">m_devname</a>;
<a name="l00187"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">00187</a>     <span class="keyword">const</span> <a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html">ProductInfo</a>* <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#16c09d20318788a2f9112b09f483f39e">m_productInfo</a>;
<a name="l00188"></a><a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#480da55cad35f92fd2cbd40362f3f6ae">00188</a>     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../df/d40/struct_x_n_i_d_a_qmx_interface_1_1_product_info.html">ProductInfo</a> <a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html#480da55cad35f92fd2cbd40362f3f6ae">sc_productInfoList</a>[];
<a name="l00189"></a>00189 };
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="keyword">template</span>&lt;<span class="keyword">class</span> tDriver&gt;
<a name="l00192"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html">00192</a> <span class="keyword">class </span><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html">XNIDAQmxDriver</a> : <span class="keyword">public</span> tDriver
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194     XNODE_OBJECT
<a name="l00195"></a>00195 <span class="keyword">protected</span>:
<a name="l00196"></a>00196     <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#ab44ce0a62597c0ed7b1add1dd88eb56">XNIDAQmxDriver</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">bool</span> runtime, 
<a name="l00197"></a>00197                    <span class="keyword">const</span> shared_ptr&lt;XScalarEntryList&gt; &amp;scalarentries,
<a name="l00198"></a>00198                    <span class="keyword">const</span> shared_ptr&lt;XInterfaceList&gt; &amp;interfaces,
<a name="l00199"></a>00199                    <span class="keyword">const</span> shared_ptr&lt;XThermometerList&gt; &amp;thermometers,
<a name="l00200"></a>00200                    <span class="keyword">const</span> shared_ptr&lt;XDriverList&gt; &amp;drivers);
<a name="l00201"></a>00201 <span class="keyword">public</span>:
<a name="l00202"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#d2aae649bcde41bbf0c3d1d98044c4c7">00202</a>     <span class="keyword">virtual</span> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#d2aae649bcde41bbf0c3d1d98044c4c7">~XNIDAQmxDriver</a>() {}
<a name="l00203"></a>00203 <span class="keyword">protected</span>:
<a name="l00204"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#5a099170db07b4022d67c6ec307400e9">00204</a>     <span class="keyword">const</span> shared_ptr&lt;XNIDAQmxInterface&gt; &amp;<a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#5a099170db07b4022d67c6ec307400e9">interface</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#4c32e16fc7ee3fcfe2a393187c3efe86">m_interface</a>;}<span class="comment"></span>
<a name="l00205"></a>00205 <span class="comment">    //! Be called just after opening interface. Call start() inside this routine appropriately.</span>
<a name="l00206"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b385d02e5642e6929e23062ab097a7ff">00206</a> <span class="comment"></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b385d02e5642e6929e23062ab097a7ff">open</a>() throw (<a class="code" href="../../db/da8/class_x_interface.html">XInterface</a>::XInterfaceError &amp;) {this-&gt;start();}<span class="comment"></span>
<a name="l00207"></a>00207 <span class="comment">    //! Be called during stopping driver. Call interface()-&gt;stop() inside this routine.</span>
<a name="l00208"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b78aee5c86bfa8d9d878ddc8be7524b8">00208</a> <span class="comment"></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b78aee5c86bfa8d9d878ddc8be7524b8">close</a>() throw (<a class="code" href="../../db/da8/class_x_interface.html">XInterface</a>::XInterfaceError &amp;) {<a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#5a099170db07b4022d67c6ec307400e9">interface</a>()-&gt;stop();}
<a name="l00209"></a>00209     <span class="keywordtype">void</span> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#2dbb323667a7cb31554c75dca8daa95a">onOpen</a>(<span class="keyword">const</span> shared_ptr&lt;XInterface&gt; &amp;);
<a name="l00210"></a>00210     <span class="keywordtype">void</span> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b5699b4aad450dd6f20fd87479bca135">onClose</a>(<span class="keyword">const</span> shared_ptr&lt;XInterface&gt; &amp;);<span class="comment"></span>
<a name="l00211"></a>00211 <span class="comment">    //! This should not cause an exception.</span>
<a name="l00212"></a>00212 <span class="comment"></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#0a776c609ba2333f9b1d257e07709928">afterStop</a>();
<a name="l00213"></a>00213 <span class="keyword">private</span>:
<a name="l00214"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#ae7bd3391859f31573bc022fb59b2797">00214</a>     shared_ptr&lt;XListener&gt; <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#ae7bd3391859f31573bc022fb59b2797">m_lsnOnOpen</a>, <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#e949d8c0476a99358373d0c01f9c5fd2">m_lsnOnClose</a>;
<a name="l00215"></a>00215   
<a name="l00216"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#4c32e16fc7ee3fcfe2a393187c3efe86">00216</a>     <span class="keyword">const</span> shared_ptr&lt;XNIDAQmxInterface&gt; <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#4c32e16fc7ee3fcfe2a393187c3efe86">m_interface</a>;
<a name="l00217"></a>00217 };
<a name="l00218"></a>00218 <span class="keyword">template</span>&lt;<span class="keyword">class</span> tDriver&gt;
<a name="l00219"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#ab44ce0a62597c0ed7b1add1dd88eb56">00219</a> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#ab44ce0a62597c0ed7b1add1dd88eb56">XNIDAQmxDriver&lt;tDriver&gt;::XNIDAQmxDriver</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">bool</span> runtime, 
<a name="l00220"></a>00220                                         <span class="keyword">const</span> shared_ptr&lt;XScalarEntryList&gt; &amp;scalarentries,
<a name="l00221"></a>00221                                         <span class="keyword">const</span> shared_ptr&lt;XInterfaceList&gt; &amp;interfaces,
<a name="l00222"></a>00222                                         <span class="keyword">const</span> shared_ptr&lt;XThermometerList&gt; &amp;thermometers,
<a name="l00223"></a>00223                                         <span class="keyword">const</span> shared_ptr&lt;XDriverList&gt; &amp;drivers) :
<a name="l00224"></a>00224     tDriver(name, runtime, scalarentries, interfaces, thermometers, drivers),
<a name="l00225"></a>00225     m_interface(<a class="code" href="../../dd/d83/class_x_node.html">XNode</a>::create&lt;<a class="code" href="../../d3/d51/class_x_n_i_d_a_qmx_interface.html">XNIDAQmxInterface</a>&gt;(<span class="stringliteral">"Interface"</span>, false,
<a name="l00226"></a>00226                                                  dynamic_pointer_cast&lt;<a class="code" href="../../d1/d87/class_x_driver.html">XDriver</a>&gt;(this-&gt;shared_from_this())))
<a name="l00227"></a>00227 {
<a name="l00228"></a>00228     interfaces-&gt;insert(<a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#4c32e16fc7ee3fcfe2a393187c3efe86">m_interface</a>);
<a name="l00229"></a>00229     <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#ae7bd3391859f31573bc022fb59b2797">m_lsnOnOpen</a> = <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#5a099170db07b4022d67c6ec307400e9">interface</a>()-&gt;onOpen().connectWeak(
<a name="l00230"></a>00230         this-&gt;shared_from_this(), &amp;<a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html">XNIDAQmxDriver&lt;tDriver&gt;::onOpen</a>);
<a name="l00231"></a>00231     <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#e949d8c0476a99358373d0c01f9c5fd2">m_lsnOnClose</a> = <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#5a099170db07b4022d67c6ec307400e9">interface</a>()-&gt;onClose().connectWeak( 
<a name="l00232"></a>00232         this-&gt;shared_from_this(), &amp;<a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html">XNIDAQmxDriver&lt;tDriver&gt;::onClose</a>);
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 <span class="keyword">template</span>&lt;<span class="keyword">class</span> tDriver&gt;
<a name="l00235"></a>00235 <span class="keywordtype">void</span>
<a name="l00236"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#2dbb323667a7cb31554c75dca8daa95a">00236</a> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#2dbb323667a7cb31554c75dca8daa95a">XNIDAQmxDriver&lt;tDriver&gt;::onOpen</a>(<span class="keyword">const</span> shared_ptr&lt;XInterface&gt; &amp;)
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238     <span class="keywordflow">try</span> {
<a name="l00239"></a>00239         <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b385d02e5642e6929e23062ab097a7ff">open</a>();
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241     <span class="keywordflow">catch</span> (<a class="code" href="../../de/d67/struct_x_interface_1_1_x_interface_error.html">XInterface::XInterfaceError</a>&amp; e) {
<a name="l00242"></a>00242         e.<a class="code" href="../../d7/d19/struct_x_kame_error.html#9a84ebcb9d45b52654fd1d071450a5ee">print</a>(this-&gt;getLabel() + <a class="code" href="../../d5/d94/namespace_k_a_m_e.html#2773169baae29cb1a051baaef534fb63">KAME::i18n</a>(<span class="stringliteral">": Opening interface failed, because "</span>));
<a name="l00243"></a>00243         <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b78aee5c86bfa8d9d878ddc8be7524b8">close</a>();
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 <span class="keyword">template</span>&lt;<span class="keyword">class</span> tDriver&gt;
<a name="l00247"></a>00247 <span class="keywordtype">void</span>
<a name="l00248"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b5699b4aad450dd6f20fd87479bca135">00248</a> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b5699b4aad450dd6f20fd87479bca135">XNIDAQmxDriver&lt;tDriver&gt;::onClose</a>(<span class="keyword">const</span> shared_ptr&lt;XInterface&gt; &amp;)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250     <span class="keywordflow">try</span> {
<a name="l00251"></a>00251         this-&gt;stop();
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253     <span class="keywordflow">catch</span> (<a class="code" href="../../de/d67/struct_x_interface_1_1_x_interface_error.html">XInterface::XInterfaceError</a>&amp; e) {
<a name="l00254"></a>00254         e.<a class="code" href="../../d7/d19/struct_x_kame_error.html#9a84ebcb9d45b52654fd1d071450a5ee">print</a>(this-&gt;getLabel() + <a class="code" href="../../d5/d94/namespace_k_a_m_e.html#2773169baae29cb1a051baaef534fb63">KAME::i18n</a>(<span class="stringliteral">": Stopping driver failed, because "</span>));
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 <span class="keyword">template</span>&lt;<span class="keyword">class</span> tDriver&gt;
<a name="l00258"></a>00258 <span class="keywordtype">void</span>
<a name="l00259"></a><a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#0a776c609ba2333f9b1d257e07709928">00259</a> <a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#0a776c609ba2333f9b1d257e07709928">XNIDAQmxDriver&lt;tDriver&gt;::afterStop</a>() {
<a name="l00260"></a>00260     <span class="keywordflow">try</span> {
<a name="l00261"></a>00261         this-&gt;<a class="code" href="../../d4/da7/class_x_n_i_d_a_qmx_driver.html#b78aee5c86bfa8d9d878ddc8be7524b8">close</a>();
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263     <span class="keywordflow">catch</span> (<a class="code" href="../../de/d67/struct_x_interface_1_1_x_interface_error.html">XInterface::XInterfaceError</a> &amp;e) {
<a name="l00264"></a>00264         e.<a class="code" href="../../d7/d19/struct_x_kame_error.html#9a84ebcb9d45b52654fd1d071450a5ee">print</a>();
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <span class="preprocessor">#endif </span><span class="comment">/*NIDAQMXDRIVER_H_*/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Sep 27 16:57:36 2008 for KAME2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
